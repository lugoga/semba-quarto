<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Masumbuko Semba">
<meta name="dcterms.date" content="2023-04-13">

<title>ng’ara - Machine learning with tidymodels: Binary Classification Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../ngara.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-XCGZZVKFDT"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-XCGZZVKFDT', { 'anonymize_ip': true});
</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="ng’ara - Machine learning with tidymodels: Binary Classification Model">
<meta name="twitter:description" content="In this post, we’ll learn how to create Machine learning models using R. Machine learning is the foundation for predictive modeling and artificial intelligence.">
<meta name="twitter:image" content="https://lugoga.github.io/semba-quarto/posts\tidymodels_classificationTrain\thumbnail_blog.png">
<meta name="twitter:creator" content="@semba753">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ng’ara</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lugoga"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/semba2020"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/channel/UC9uZ1KPyo7zIzI4BnUtHPfA"><i class="bi bi-youtube" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-apps--links" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Apps &amp; Links</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-apps--links">    
        <li>
    <a class="dropdown-item" href="https://semba.netlify.app/">
 <span class="dropdown-text">Semba-blog Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://semba-blog.netlify.app/">
 <span class="dropdown-text">Semba Data Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://semba.shinyapps.io/kwala/">
 <span class="dropdown-text">Kwala commercial CIty</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://semba.shinyapps.io/coastal_dashboard/">
 <span class="dropdown-text">Marine Hub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://nemp.shinyapps.io/nemp/">
 <span class="dropdown-text">Environmental Master Plan</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://semba.shinyapps.io/OceanWebApp/">
 <span class="dropdown-text">Hydrographic Data Hub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://semba.shinyapps.io/marineTz/">
 <span class="dropdown-text">Potential Fishing Zones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://semba.shinyapps.io/vizingaApp/">
 <span class="dropdown-text">TAFIRI Apps</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rweekly.org/">
 <span class="dropdown-text">R Weekly</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.r-bloggers.com/">
 <span class="dropdown-text">R Bloggers</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.tmbish.me/lab/highcharter-cookbook/">
 <span class="dropdown-text">Highcharter</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html">
 <span class="menu-text">Archive</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#a-gentle-introduction" id="toc-a-gentle-introduction" class="nav-link active" data-scroll-target="#a-gentle-introduction">A gentle introduction</a>
  <ul class="collapse">
  <li><a href="#binary-classification" id="toc-binary-classification" class="nav-link" data-scroll-target="#binary-classification">Binary classification</a>
  <ul class="collapse">
  <li><a href="#explore-the-data" id="toc-explore-the-data" class="nav-link" data-scroll-target="#explore-the-data">Explore the data</a></li>
  <li><a href="#split-the-data" id="toc-split-the-data" class="nav-link" data-scroll-target="#split-the-data">Split the data</a></li>
  </ul></li>
  <li><a href="#train-and-evaluate-a-binary-classification-model" id="toc-train-and-evaluate-a-binary-classification-model" class="nav-link" data-scroll-target="#train-and-evaluate-a-binary-classification-model">Train and Evaluate a Binary Classification Model</a>
  <ul class="collapse">
  <li><a href="#logistic-regression-algorithm" id="toc-logistic-regression-algorithm" class="nav-link" data-scroll-target="#logistic-regression-algorithm">Logistic regression Algorithm</a></li>
  <li><a href="#random-forest-algorithm" id="toc-random-forest-algorithm" class="nav-link" data-scroll-target="#random-forest-algorithm">Random Forest Algorithm</a></li>
  </ul></li>
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#cited-materials" id="toc-cited-materials" class="nav-link" data-scroll-target="#cited-materials">Cited Materials</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Machine learning with tidymodels: Binary Classification Model</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Manipulation</div>
    <div class="quarto-category">Visualization</div>
    <div class="quarto-category">R</div>
    <div class="quarto-category">Modelling</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <a href="https://semba.netlify.app">Masumbuko Semba</a> <a href="https://orcid.org/0000-0002-5002-9747" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://semba.netlify.app/">
            Nelson Mandela African Institution of Science and Technology
            </a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">April 13, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="a-gentle-introduction" class="level1">
<h1>A gentle introduction</h1>
<p>In this post, we’ll learn how to create Machine learning models using R. Machine learning is the foundation for predictive modeling and artificial intelligence. We’ll learn the core principles of machine learning and how to use common tools and frameworks to train, evaluate, and use machine learning models. in this post we are going to manipulate and visualize diabetes dataset and train and evaluate binary regression models. But before we proceed, we need some packages to accomplish the step in this post. We can have them installed as:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">install.packages</span>(<span class="fu">c</span>(<span class="st">'tidyverse'</span>, <span class="st">'tidymodels'</span>, <span class="st">'ranger'</span>, <span class="st">'vip'</span>, <span class="st">'palmerpenguins'</span>, <span class="st">'skimr'</span>, <span class="st">'paletteer'</span>, <span class="st">'nnet'</span>, <span class="st">'here'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we load the packages in the session</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="fu">require</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="fu">require</span>(tidymodels)</span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="fu">require</span>(magrittr)</span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="fu">require</span>(patchwork)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="binary-classification" class="level2">
<h2 class="anchored" data-anchor-id="binary-classification">Binary classification</h2>
<p>Let’s start by looking at an example of <em>binary</em> classification, where the model must predict a label that belongs to one of two classes. In this exercise, we’ll train a binary classifier to predict whether or not a patient should be tested for diabetes based on some medical data.</p>
<section id="explore-the-data" class="level3">
<h3 class="anchored" data-anchor-id="explore-the-data">Explore the data</h3>
<p>Let’s first import a file of patients data direct from the internet with <code>read_csv</code> function of <strong>readr</strong> package <span class="citation" data-cites="readr">(<a href="#ref-readr" role="doc-biblioref">Wickham, Hester, &amp; Francois, 2017</a>)</span>, part of the tidyverse ecosystem <span class="citation" data-cites="tidyverse">(<a href="#ref-tidyverse" role="doc-biblioref">Wickham &amp; Wickham, 2017</a>)</span>;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>diabetes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="at">file =</span> <span class="st">"https://raw.githubusercontent.com/MicrosoftDocs/ml-basics/master/data/diabetes.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then print the dataset to explore the variables and records contained in the dataset;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>diabetes</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15,000 x 10
   PatientID Pregn~1 Plasm~2 Diast~3 Trice~4 Serum~5   BMI Diabe~6   Age Diabe~7
       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;
 1   1354778       0     171      80      34      23  43.5  1.21      21       0
 2   1147438       8      92      93      47      36  21.2  0.158     23       0
 3   1640031       7     115      47      52      35  41.5  0.0790    23       0
 4   1883350       9     103      78      25     304  29.6  1.28      43       1
 5   1424119       1      85      59      27      35  42.6  0.550     22       0
 6   1619297       0      82      92       9     253  19.7  0.103     26       0
 7   1660149       0     133      47      19     227  21.9  0.174     21       0
 8   1458769       0      67      87      43      36  18.3  0.236     26       0
 9   1201647       8      80      95      33      24  26.6  0.444     53       1
10   1403912       1      72      31      40      42  36.9  0.104     26       0
# ... with 14,990 more rows, and abbreviated variable names 1: Pregnancies,
#   2: PlasmaGlucose, 3: DiastolicBloodPressure, 4: TricepsThickness,
#   5: SerumInsulin, 6: DiabetesPedigree, 7: Diabetic</code></pre>
</div>
</div>
<p>Though the printed output tell us that there are fifteen thousand records and ten variable, but sometimes you may wish to explore the internal structure of the dataset. The <code>glimpse</code> function from <strong>dplyr</strong> package can do that by listing the available variables and their types;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>diabetes <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2"></a>  <span class="fu">glimpse</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 15,000
Columns: 10
$ PatientID              &lt;dbl&gt; 1354778, 1147438, 1640031, 1883350, 1424119, 16~
$ Pregnancies            &lt;dbl&gt; 0, 8, 7, 9, 1, 0, 0, 0, 8, 1, 1, 3, 5, 7, 0, 3,~
$ PlasmaGlucose          &lt;dbl&gt; 171, 92, 115, 103, 85, 82, 133, 67, 80, 72, 88,~
$ DiastolicBloodPressure &lt;dbl&gt; 80, 93, 47, 78, 59, 92, 47, 87, 95, 31, 86, 96,~
$ TricepsThickness       &lt;dbl&gt; 34, 47, 52, 25, 27, 9, 19, 43, 33, 40, 11, 31, ~
$ SerumInsulin           &lt;dbl&gt; 23, 36, 35, 304, 35, 253, 227, 36, 24, 42, 58, ~
$ BMI                    &lt;dbl&gt; 43.50973, 21.24058, 41.51152, 29.58219, 42.6045~
$ DiabetesPedigree       &lt;dbl&gt; 1.21319135, 0.15836498, 0.07901857, 1.28286985,~
$ Age                    &lt;dbl&gt; 21, 23, 23, 43, 22, 26, 21, 26, 53, 26, 22, 23,~
$ Diabetic               &lt;dbl&gt; 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1,~</code></pre>
</div>
</div>
<p>This data consists of 15,000 patients with 10 variables that were used to diagnose diabetes. In this post we tread a <code>Diabetic</code> as <em>outome</em> and the remaining variables as <em>predictor</em>. A predictor variable is used to predict the occurrence and/or level of another variable, called the outcome variable. Let’s tidy and reorganize in format that easy for model to understand. The variable names do not follow the recommended standard therefore we clean them using <code>clean_names</code> function from janitor package <span class="citation" data-cites="janitor">(<a href="#ref-janitor" role="doc-biblioref">Firke, 2020</a>)</span>. We also notice that some of the variable like PatientId adds no effect in the model and was dropped from the dataset.</p>
<p>Further, since we are going to use classification algorithm in this we need to convert our our predictor variable–diabetic–from numerical to factor. This is the outcome (label) and other variable like Pregnancies, PlasmaGlucose, DiastolicBloodPressure, BMI and so on are the predictor (features) we will use to predict the Diabetic label.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a>diabetes.tidy <span class="ot">=</span> diabetes <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3"></a>  <span class="fu">select</span>(<span class="sc">-</span>patient_id) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="#cb8-4"></a>  <span class="fu">mutate</span>(<span class="at">diabetic =</span> <span class="fu">if_else</span>(diabetic <span class="sc">==</span> <span class="dv">1</span>, <span class="st">"Diabetic"</span>, <span class="st">"Non diabetic"</span>),</span>
<span id="cb8-5"><a href="#cb8-5"></a>         <span class="at">diabetic =</span> <span class="fu">as.factor</span>(diabetic))</span>
<span id="cb8-6"><a href="#cb8-6"></a></span>
<span id="cb8-7"><a href="#cb8-7"></a>diabetes.tidy</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 15,000 x 9
   pregnancies plasma_gluc~1 diast~2 trice~3 serum~4   bmi diabe~5   age diabe~6
         &lt;dbl&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;  
 1           0           171      80      34      23  43.5  1.21      21 Non di~
 2           8            92      93      47      36  21.2  0.158     23 Non di~
 3           7           115      47      52      35  41.5  0.0790    23 Non di~
 4           9           103      78      25     304  29.6  1.28      43 Diabet~
 5           1            85      59      27      35  42.6  0.550     22 Non di~
 6           0            82      92       9     253  19.7  0.103     26 Non di~
 7           0           133      47      19     227  21.9  0.174     21 Non di~
 8           0            67      87      43      36  18.3  0.236     26 Non di~
 9           8            80      95      33      24  26.6  0.444     53 Diabet~
10           1            72      31      40      42  36.9  0.104     26 Non di~
# ... with 14,990 more rows, and abbreviated variable names 1: plasma_glucose,
#   2: diastolic_blood_pressure, 3: triceps_thickness, 4: serum_insulin,
#   5: diabetes_pedigree, 6: diabetic</code></pre>
</div>
</div>
<p>Our primary goal of data exploration is to try to understand the existing relationship patterns between variables in the dataset. Therefore, we should assess any apparent correlation using picture through data visualization. To make it easy to plot multiple plot at once, the format of our dataset at this stage is wide, and that prevent us doing that. In order to plot all variable in single plot, we must first convert the dataset from wide format to long format, and we can do that using <code>pivot_longer</code> function from <strong>dplyr</strong> package <span class="citation" data-cites="dplyr">(<a href="#ref-dplyr" role="doc-biblioref">Wickham, François, Henry, &amp; Müller, 2019</a>)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a>diabetes.tidy.long <span class="ot">=</span> diabetes.tidy <span class="sc">%&gt;%</span> </span>
<span id="cb10-2"><a href="#cb10-2"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb10-3"><a href="#cb10-3"></a>    <span class="at">cols =</span> <span class="sc">!</span>diabetic, </span>
<span id="cb10-4"><a href="#cb10-4"></a>    <span class="at">names_to =</span> <span class="st">"features"</span>, </span>
<span id="cb10-5"><a href="#cb10-5"></a>    <span class="at">values_to =</span> <span class="st">"values"</span></span>
<span id="cb10-6"><a href="#cb10-6"></a>               )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Once we have pivoted the data to long format, we can create plot in a single plot using multiple facet;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_light</span>())</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>diabetes.tidy.long <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> diabetic, <span class="at">y =</span> values, <span class="at">fill =</span> features)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb11-6"><a href="#cb11-6"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> features, <span class="at">scales =</span> <span class="st">"free"</span>, <span class="at">ncol =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">end =</span> .<span class="dv">7</span>) <span class="sc">+</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">name =</span> <span class="st">"Values"</span>, <span class="at">trans =</span> scales<span class="sc">::</span><span class="fu">sqrt_trans</span>())<span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>, <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb11-10"><a href="#cb11-10"></a>        <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"grey60"</span>), </span>
<span id="cb11-11"><a href="#cb11-11"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"white"</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig1" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-fig1-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Boxplot of the predictor variables between diabetic and non-diabetic patients</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The values of the predictor vary between diabetic and non-diabetic individuals. In particular, with exception of diabetes_pedigree and triceps_thickness, other predictors show that diabetic individual with relatively high values than non-diabetic (<a href="#fig-fig1">Figure&nbsp;1</a>). These features may help predict whether or not a patient is diabetic.</p>
</section>
<section id="split-the-data" class="level3">
<h3 class="anchored" data-anchor-id="split-the-data">Split the data</h3>
<p>Our dataset includes known values for the label, so we can use this to train a classifier so that it finds a statistical relationship between the features and the label value; but how will we know if our model is any good? How do we know it will predict correctly when we use it with new data that it wasn’t trained with?</p>
<p>It is best practice to hold out part of the data for testing in order to get a better estimate of how models will perform on new data by comparing the predicted labels with the already known labels in the test set. Well, we can take advantage of the fact we have a large dataset with known label values, use only some of it to train the model, and hold back some to test the trained model - enabling us to compare the predicted labels with the already known labels in the test set.</p>
<p>In R, the <strong>tidymodels</strong> framework provides a collection of packages for modeling and machine learning using tidyverse principles <span class="citation" data-cites="tidymodels">(<a href="#ref-tidymodels" role="doc-biblioref">Kuhn &amp; Wickham, 2020</a>)</span>. For instance, <strong>rsample</strong>, a package in tidymodels, provides infrastructure for efficient data splitting and resampling <span class="citation" data-cites="rsample">(<a href="#ref-rsample" role="doc-biblioref">Kuhn, Chow, &amp; Wickham, 2020</a>)</span>:</p>
<ul>
<li><code>initial_split()</code>: specifies how data will be split into a training and testing set</li>
<li><code>training()</code> and <code>testing()</code> functions extract the data in each split</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co"># Split data into 70% for training and 30% for testing</span></span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="fu">set.seed</span>(<span class="dv">2056</span>)</span>
<span id="cb12-3"><a href="#cb12-3"></a>diabetes_split <span class="ot">&lt;-</span> diabetes.tidy <span class="sc">%&gt;%</span> </span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="fu">initial_split</span>(<span class="at">prop =</span> <span class="fl">0.70</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a></span>
<span id="cb12-6"><a href="#cb12-6"></a></span>
<span id="cb12-7"><a href="#cb12-7"></a><span class="co"># Extract the data in each split</span></span>
<span id="cb12-8"><a href="#cb12-8"></a>diabetes_train <span class="ot">&lt;-</span> <span class="fu">training</span>(diabetes_split)</span>
<span id="cb12-9"><a href="#cb12-9"></a>diabetes_test <span class="ot">&lt;-</span> <span class="fu">testing</span>(diabetes_split)</span>
<span id="cb12-10"><a href="#cb12-10"></a></span>
<span id="cb12-11"><a href="#cb12-11"></a></span>
<span id="cb12-12"><a href="#cb12-12"></a><span class="co"># Print the number of cases in each split</span></span>
<span id="cb12-13"><a href="#cb12-13"></a><span class="fu">cat</span>(<span class="st">"Training cases: "</span>, <span class="fu">nrow</span>(diabetes_train), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>,</span>
<span id="cb12-14"><a href="#cb12-14"></a>    <span class="st">"Test cases: "</span>, <span class="fu">nrow</span>(diabetes_test), <span class="at">sep =</span> <span class="st">""</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training cases: 10500
Test cases: 4500</code></pre>
</div>
</div>
</section>
</section>
<section id="train-and-evaluate-a-binary-classification-model" class="level2">
<h2 class="anchored" data-anchor-id="train-and-evaluate-a-binary-classification-model">Train and Evaluate a Binary Classification Model</h2>
<p>Once we have separated the dataset into train and test set, now we’re ready to train our model by fitting the training features to the training labels (diabetic). There are various algorithms we can use to train the model.</p>
<section id="logistic-regression-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="logistic-regression-algorithm">Logistic regression Algorithm</h3>
<p>In this section, we’ll use <em>Logistic Regression</em>, which is a well-established algorithm for classification. Logistic regression is a binary classification algorithm, meaning it predicts two categories. There are quite a number of ways to fit a logistic regression model in tidymodels. For now, let’s fit a logistic regression model via the default <code>stats::glm()</code> engine.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co"># Make a model specification</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>logreg_spec <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">set_engine</span>(<span class="st">"glm"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb14-5"><a href="#cb14-5"></a></span>
<span id="cb14-6"><a href="#cb14-6"></a></span>
<span id="cb14-7"><a href="#cb14-7"></a><span class="co"># Print the model specification</span></span>
<span id="cb14-8"><a href="#cb14-8"></a>logreg_spec</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Logistic Regression Model Specification (classification)

Computational engine: glm </code></pre>
</div>
</div>
<p>After a model has been specified, the model can be estimated or trained using the fit() function, typically using a symbolic description of the model (a formula) and some data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a><span class="co"># Train a logistic regression model</span></span>
<span id="cb16-2"><a href="#cb16-2"></a>logreg_fit <span class="ot">&lt;-</span> logreg_spec <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3"></a>  <span class="fu">fit</span>(diabetic <span class="sc">~</span> ., <span class="at">data =</span> diabetes_train)</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a></span>
<span id="cb16-6"><a href="#cb16-6"></a><span class="co"># Print the model object</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>logreg_fit</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object


Call:  stats::glm(formula = diabetic ~ ., family = stats::binomial, 
    data = data)

Coefficients:
             (Intercept)               pregnancies            plasma_glucose  
                8.624243                 -0.266296                 -0.009615  
diastolic_blood_pressure         triceps_thickness             serum_insulin  
               -0.012297                 -0.022807                 -0.003932  
                     bmi         diabetes_pedigree                       age  
               -0.049028                 -0.923262                 -0.056876  

Degrees of Freedom: 10499 Total (i.e. Null);  10491 Residual
Null Deviance:      13290 
Residual Deviance: 9221     AIC: 9239</code></pre>
</div>
</div>
<p>The model print out shows the coefficients learned during training. Now we’ve trained the model using the training data, we can use the test data we held back to evaluate how well it predicts using <code>parsnip::predict()</code>. Let’s start by using the model to predict labels for our test set, and compare the predicted labels to the known labels:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Make predictions then bind them to the test set</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>results <span class="ot">&lt;-</span> diabetes_test <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="fu">select</span>(diabetic) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="fu">bind_cols</span>(</span>
<span id="cb18-5"><a href="#cb18-5"></a>    logreg_fit <span class="sc">%&gt;%</span> <span class="fu">predict</span>(<span class="at">new_data =</span> diabetes_test)</span>
<span id="cb18-6"><a href="#cb18-6"></a>    )</span>
<span id="cb18-7"><a href="#cb18-7"></a></span>
<span id="cb18-8"><a href="#cb18-8"></a><span class="co"># Compare predictions</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb18-10"><a href="#cb18-10"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 x 2
   diabetic     .pred_class 
   &lt;fct&gt;        &lt;fct&gt;       
 1 Non diabetic Non diabetic
 2 Non diabetic Non diabetic
 3 Non diabetic Non diabetic
 4 Non diabetic Non diabetic
 5 Diabetic     Diabetic    
 6 Non diabetic Non diabetic
 7 Non diabetic Non diabetic
 8 Diabetic     Non diabetic
 9 Non diabetic Non diabetic
10 Non diabetic Non diabetic</code></pre>
</div>
</div>
<p>Comparing each prediction with its corresponding “ground truth” actual value isn’t a very efficient way to determine how well the model is predicting. Fortunately, <strong>tidymodels</strong> has a few more tricks up its sleeve: <strong>yardstick</strong> - a package used to measure the effectiveness of models using performance metrics <span class="citation" data-cites="yardstick">(<a href="#ref-yardstick" role="doc-biblioref">Kuhn &amp; Vaughan, 2020</a>)</span>. The most obvious thing you might want to do is to check the accuracy of the predictions - in simple terms, what proportion of the labels did the model predict correctly? <code>yardstick::accuracy()</code> does just that!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Calculate accuracy: proportion of data predicted correctly</span></span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="fu">accuracy</span>(</span>
<span id="cb20-3"><a href="#cb20-3"></a>  <span class="at">data =</span> results, </span>
<span id="cb20-4"><a href="#cb20-4"></a>  <span class="at">truth =</span> diabetic, </span>
<span id="cb20-5"><a href="#cb20-5"></a>  <span class="at">estimate =</span> .pred_class</span>
<span id="cb20-6"><a href="#cb20-6"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.789</code></pre>
</div>
</div>
<p>The accuracy is returned as a decimal value - a value of 1.0 would mean that the model got 100% of the predictions right; while an accuracy of 0.0 is, well, pretty useless! Accuracy seems like a sensible metric to evaluate (and to a certain extent it is), but you need to be careful about drawing too many conclusions from the accuracy of a classifier. Remember that it’s simply a measure of how many cases were predicted correctly. Suppose only 3% of the population is diabetic. You could create a classifier that always just predicts 0, and it would be 97% accurate - but not terribly helpful in identifying patients with diabetes!</p>
<p>Fortunately, there are some other metrics that reveal a little more about how our classification model is performing.One performance metric associated with classification problems is the confusion matrix. A confusion matrix describes how well a classification model performs by tabulating how many examples in each class were correctly classified by a model. In our case, it will show you how many cases were classified as negative (0) and how many as positive (1); the confusion matrix also shows you how many were classified into the wrong categories. The <code>conf_mat()</code> function from yardstick calculates this cross-tabulation of observed and predicted classes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a><span class="co"># Confusion matrix for prediction results</span></span>
<span id="cb22-2"><a href="#cb22-2"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb22-3"><a href="#cb22-3"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> diabetic, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Truth
Prediction     Diabetic Non diabetic
  Diabetic          897          293
  Non diabetic      657         2653</code></pre>
</div>
</div>
<p>The descriptive statistic of confusion matrix presented above can be presented visually as shown in <a href="#fig-confmat">Figure&nbsp;2</a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Visualize conf mat</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="fu">update_geom_defaults</span>(<span class="at">geom =</span> <span class="st">"rect"</span>, <span class="at">new =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">"midnightblue"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>))</span>
<span id="cb24-3"><a href="#cb24-3"></a></span>
<span id="cb24-4"><a href="#cb24-4"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="fu">conf_mat</span>(diabetic, .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb24-6"><a href="#cb24-6"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-confmat" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-confmat-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Visualize confusion matrix plot</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><strong>tidymodels</strong> provides yet another succinct way of evaluating all these metrics. Using <code>yardstick::metric_set()</code>, you can combine multiple metrics together into a new function that calculates all of them at once.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># Combine metrics and evaluate them all at once</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>eval_metrics <span class="ot">&lt;-</span> </span>
<span id="cb25-3"><a href="#cb25-3"></a>  <span class="fu">metric_set</span>(ppv, recall, accuracy, f_meas)</span>
<span id="cb25-4"><a href="#cb25-4"></a></span>
<span id="cb25-5"><a href="#cb25-5"></a></span>
<span id="cb25-6"><a href="#cb25-6"></a><span class="fu">eval_metrics</span>(</span>
<span id="cb25-7"><a href="#cb25-7"></a>  <span class="at">data =</span> results, </span>
<span id="cb25-8"><a href="#cb25-8"></a>  <span class="at">truth =</span> diabetic, </span>
<span id="cb25-9"><a href="#cb25-9"></a>  <span class="at">estimate =</span> .pred_class</span>
<span id="cb25-10"><a href="#cb25-10"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 x 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 ppv      binary         0.754
2 recall   binary         0.577
3 accuracy binary         0.789
4 f_meas   binary         0.654</code></pre>
</div>
</div>
<p>Until now, we’ve considered the predictions from the model as being either 1 or 0 class labels. Actually, things are a little more complex than that. Statistical machine learning algorithms, like logistic regression, are based on probability; so what actually gets predicted by a binary classifier is the probability that the label is true <span class="math inline">\(P(y)\)</span> ) and the probability that the label is false <span class="math inline">\(1−P(y)\)</span>. A threshold value of 0.5 is used to decide whether the predicted label is a 1 <span class="math inline">\(P(y)&gt;0.5\)</span> or a 0 <span class="math inline">\(P(y)&lt;=0.5\)</span>. Let’s see the probability pairs for each case:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># Predict class probabilities and bind them to results</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>results <span class="ot">&lt;-</span> results <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">bind_cols</span>(logreg_fit <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="#cb27-4"></a>              <span class="fu">predict</span>(<span class="at">new_data =</span> diabetes_test, <span class="at">type =</span> <span class="st">"prob"</span>))</span>
<span id="cb27-5"><a href="#cb27-5"></a></span>
<span id="cb27-6"><a href="#cb27-6"></a>  </span>
<span id="cb27-7"><a href="#cb27-7"></a></span>
<span id="cb27-8"><a href="#cb27-8"></a></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="co"># Print out the results</span></span>
<span id="cb27-10"><a href="#cb27-10"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb27-11"><a href="#cb27-11"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 x 4
   diabetic     .pred_class  .pred_Diabetic `.pred_Non diabetic`
   &lt;fct&gt;        &lt;fct&gt;                 &lt;dbl&gt;                &lt;dbl&gt;
 1 Non diabetic Non diabetic         0.417                 0.583
 2 Non diabetic Non diabetic         0.0985                0.902
 3 Non diabetic Non diabetic         0.0469                0.953
 4 Non diabetic Non diabetic         0.0561                0.944
 5 Diabetic     Diabetic             0.581                 0.419
 6 Non diabetic Non diabetic         0.331                 0.669
 7 Non diabetic Non diabetic         0.288                 0.712
 8 Diabetic     Non diabetic         0.270                 0.730
 9 Non diabetic Non diabetic         0.275                 0.725
10 Non diabetic Non diabetic         0.131                 0.869</code></pre>
</div>
</div>
<p>The decision to score a prediction as a 1 or a 0 depends on the threshold to which the predicted probabilities are compared. If we were to change the threshold, it would affect the predictions; and therefore change the metrics in the confusion matrix. A common way to evaluate a classifier is to examine the true positive rate (which is another name for recall) and the false positive rate <span class="math inline">\((1 - specificity)\)</span> for a range of possible thresholds. These rates are then plotted against all possible thresholds to form a chart known as a received operator characteristic (ROC) chart, like this:</p>
<div class="callout-important callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>A receiver operating characteristic curve, or ROC curve, is a graphical plot that illustrates the diagnostic ability of a binary classifier system as its discrimination threshold is varied.</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co"># Make a roc_chart</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb29-3"><a href="#cb29-3"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> diabetic, .pred_Diabetic) <span class="sc">%&gt;%</span> </span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-roc" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-roc-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: The ROC curve</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>The <a href="#fig-roc">Figure&nbsp;3</a> shows the curve of the true and false positive rates for different threshold values between 0 and 1. A perfect classifier would have a curve that goes straight up the left side and straight across the top. The diagonal line across the chart represents the probability of predicting correctly with a <span class="math inline">\(\frac{50}{50}\)</span> random prediction; so you obviously want the curve to be higher than that (or your model is no better than simply guessing!).</p>
<p>The area under the curve (AUC) is a value between 0 and 1 that quantifies the overall performance of the model. One way of interpreting AUC is as the probability that the model ranks a random positive example more highly than a random negative example. The closer to 1 this value is, the better the model. Once again, <code>tidymodels</code> includes a function to calculate this metric: <code>yardstick::roc_auc()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># Compute the AUC</span></span>
<span id="cb30-2"><a href="#cb30-2"></a>results <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3"></a>  <span class="fu">roc_auc</span>(diabetic, .pred_Diabetic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 3
  .metric .estimator .estimate
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
1 roc_auc binary         0.860</code></pre>
</div>
</div>
</section>
<section id="random-forest-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="random-forest-algorithm">Random Forest Algorithm</h3>
<p>We have been dealing with logistic regression, which is a linear algorithm. tidymodels provide a swift approach to change algorithms in the model. For instance , we can change the logistic regression to other kind of classification algorithms inluding:</p>
<ul>
<li><em>Support Vector Machine algorithms</em>: Algorithms that define a hyperplane that separates classes.</li>
<li><em>Tree-based algorithms</em>: Algorithms that build a decision tree to reach a prediction</li>
<li><em>Ensemble algorithms</em>: Algorithms that combine the outputs of multiple base algorithms to improve generalizability.</li>
</ul>
<p>To make life simple, let us train the model using an ensemble algorithm named <em>Random Forest</em> that averages the outputs of multiple random decision trees. Random forests help to reduce tree correlation by injecting more randomness into the tree-growing process. More specifically, instead of considering all predictors in the data, for calculating a given split, random forests pick a random sample of predictors to be considered for that split.</p>
<p>Given the experience of the logistic regression model, the power of tidymodels is consistence and therefore we do not need to start over, the only thing we need to do is simply to specify and fit a random forest algorithm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># Preprocess the data for modelling</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>diabetes_recipe <span class="ot">&lt;-</span> <span class="fu">recipe</span>(diabetic <span class="sc">~</span> ., <span class="at">data =</span> diabetes_train) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3"></a>  <span class="fu">step_mutate</span>(<span class="at">age =</span> <span class="fu">factor</span>(age)) <span class="sc">%&gt;%</span> </span>
<span id="cb32-4"><a href="#cb32-4"></a>  <span class="fu">step_normalize</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5"></a>  <span class="fu">step_dummy</span>(age)</span>
<span id="cb32-6"><a href="#cb32-6"></a></span>
<span id="cb32-7"><a href="#cb32-7"></a><span class="co"># specify a random forest model specification</span></span>
<span id="cb32-8"><a href="#cb32-8"></a>rf_spec <span class="ot">&lt;-</span> <span class="fu">rand_forest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-9"><a href="#cb32-9"></a>  <span class="fu">set_engine</span>(<span class="st">"ranger"</span>, <span class="at">importance =</span> <span class="st">"impurity"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-10"><a href="#cb32-10"></a>  <span class="fu">set_mode</span>(<span class="st">"classification"</span>)</span>
<span id="cb32-11"><a href="#cb32-11"></a></span>
<span id="cb32-12"><a href="#cb32-12"></a><span class="co"># Bundle recipe and model spec into a workflow</span></span>
<span id="cb32-13"><a href="#cb32-13"></a>rf_wf <span class="ot">&lt;-</span> <span class="fu">workflow</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb32-14"><a href="#cb32-14"></a>  <span class="fu">add_recipe</span>(diabetes_recipe) <span class="sc">%&gt;%</span> </span>
<span id="cb32-15"><a href="#cb32-15"></a>  <span class="fu">add_model</span>(rf_spec)</span>
<span id="cb32-16"><a href="#cb32-16"></a></span>
<span id="cb32-17"><a href="#cb32-17"></a><span class="co"># Fit a model</span></span>
<span id="cb32-18"><a href="#cb32-18"></a>rf_wf_fit <span class="ot">&lt;-</span> rf_wf <span class="sc">%&gt;%</span> </span>
<span id="cb32-19"><a href="#cb32-19"></a>  <span class="fu">fit</span>(<span class="at">data =</span> diabetes_train)</span>
<span id="cb32-20"><a href="#cb32-20"></a></span>
<span id="cb32-21"><a href="#cb32-21"></a><span class="co"># # spefiy the model</span></span>
<span id="cb32-22"><a href="#cb32-22"></a><span class="co"># rf.fit  = rand_forest() %&gt;% </span></span>
<span id="cb32-23"><a href="#cb32-23"></a><span class="co">#   set_engine(engine = "ranger") %&gt;% </span></span>
<span id="cb32-24"><a href="#cb32-24"></a><span class="co">#   set_mode(mode = "classification") %&gt;% </span></span>
<span id="cb32-25"><a href="#cb32-25"></a><span class="co">#   # fit the model</span></span>
<span id="cb32-26"><a href="#cb32-26"></a><span class="co">#   fit(diabetic ~ ., data = diabetes_train)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we make prediction of the fitted model with the test dataset</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>rf.prediction <span class="ot">=</span> rf_wf_fit <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="#cb33-2"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> diabetes_test)</span>
<span id="cb33-3"><a href="#cb33-3"></a></span>
<span id="cb33-4"><a href="#cb33-4"></a>rf.prediction.prob  <span class="ot">=</span>  rf_wf_fit <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="#cb33-5"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> diabetes_test, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb33-6"><a href="#cb33-6"></a></span>
<span id="cb33-7"><a href="#cb33-7"></a>rf.prediction <span class="ot">=</span>  rf.prediction <span class="sc">%&gt;%</span> </span>
<span id="cb33-8"><a href="#cb33-8"></a>  <span class="fu">bind_cols</span>(rf.prediction.prob)</span>
<span id="cb33-9"><a href="#cb33-9"></a></span>
<span id="cb33-10"><a href="#cb33-10"></a>rf.result <span class="ot">=</span> diabetes_test <span class="sc">%&gt;%</span> </span>
<span id="cb33-11"><a href="#cb33-11"></a>  <span class="fu">select</span>(diabetic) <span class="sc">%&gt;%</span> </span>
<span id="cb33-12"><a href="#cb33-12"></a>  <span class="fu">bind_cols</span>(rf.prediction)</span>
<span id="cb33-13"><a href="#cb33-13"></a></span>
<span id="cb33-14"><a href="#cb33-14"></a>rf.result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,500 x 4
   diabetic     .pred_class  .pred_Diabetic `.pred_Non diabetic`
   &lt;fct&gt;        &lt;fct&gt;                 &lt;dbl&gt;                &lt;dbl&gt;
 1 Non diabetic Non diabetic        0.275                 0.725 
 2 Non diabetic Non diabetic        0.0137                0.986 
 3 Non diabetic Non diabetic        0.00739               0.993 
 4 Non diabetic Non diabetic        0.0108                0.989 
 5 Diabetic     Diabetic            0.910                 0.0902
 6 Non diabetic Non diabetic        0.103                 0.897 
 7 Non diabetic Non diabetic        0.237                 0.763 
 8 Diabetic     Non diabetic        0.270                 0.730 
 9 Non diabetic Non diabetic        0.0484                0.952 
10 Non diabetic Non diabetic        0.0326                0.967 
# ... with 4,490 more rows</code></pre>
</div>
</div>
<p>The printed predicted of the random forest looks complelling, let’s evaluate its metrics!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>rf.result <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> diabetic, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Truth
Prediction     Diabetic Non diabetic
  Diabetic         1368           99
  Non diabetic      186         2847</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>rf.result <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> diabetic, <span class="at">estimate =</span> .pred_class) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3"></a>  <span class="fu">autoplot</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We notice that there a considerable increase in the number of True Positives and True Negatives, which is a step in the right direction. Let’s take a look at other evaluation metrics</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a>rf.result <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> diabetic, <span class="at">estimate =</span> .pred_class)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 x 3
  .metric  .estimator .estimate
  &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
1 accuracy binary         0.937</code></pre>
</div>
</div>
<p>There is considerable improvement of the accuracy from .75 to around 0.93. The high accuracy of the random forest is also clearly visible in ROC curve (<a href="#fig-roc-rf">Figure&nbsp;4</a>) with considervable high value of area under the curve (AUC).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>roc.values <span class="ot">=</span> rf.result <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2"></a>  <span class="fu">roc_auc</span>(<span class="at">truth =</span> diabetic, .pred_Diabetic) <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="fu">pull</span>(.estimate) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="#cb40-4"></a>  <span class="fu">round</span>(<span class="dv">2</span>)</span>
<span id="cb40-5"><a href="#cb40-5"></a></span>
<span id="cb40-6"><a href="#cb40-6"></a>rf.result <span class="sc">%&gt;%</span> </span>
<span id="cb40-7"><a href="#cb40-7"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> diabetic, .pred_Diabetic) <span class="sc">%&gt;%</span> </span>
<span id="cb40-8"><a href="#cb40-8"></a>  <span class="fu">autoplot</span>()<span class="sc">+</span></span>
<span id="cb40-9"><a href="#cb40-9"></a>  <span class="fu">annotate</span>(<span class="at">geom =</span> <span class="st">"text"</span>, <span class="at">x =</span> .<span class="dv">75</span>, <span class="at">y =</span> .<span class="dv">25</span>, <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"AUC-value = "</span>, roc.values))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-roc-rf" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-roc-rf-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: ROC curve of random forest</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p><a href="#fig-vip">Figure&nbsp;5</a> is a Variable Importance Plot (VIP) that illustrates importance of each predictor variables used to predict the diabetic outcome in a random forest model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a><span class="co"># Load vip</span></span>
<span id="cb41-2"><a href="#cb41-2"></a><span class="fu">library</span>(vip)</span>
<span id="cb41-3"><a href="#cb41-3"></a></span>
<span id="cb41-4"><a href="#cb41-4"></a><span class="co"># Extract the fitted model from the workflow</span></span>
<span id="cb41-5"><a href="#cb41-5"></a>rf_wf_fit <span class="sc">%&gt;%</span> </span>
<span id="cb41-6"><a href="#cb41-6"></a>  <span class="fu">extract_fit_parsnip</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb41-7"><a href="#cb41-7"></a><span class="co"># Make VIP plot</span></span>
<span id="cb41-8"><a href="#cb41-8"></a>  <span class="fu">vip</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-vip" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-vip-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: Model-specific VIPs of tree-based model random forest</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="summary" class="level2">
<h2 class="anchored" data-anchor-id="summary">Summary</h2>
<p>We notice that random forest has high predictive power compared to the logistic regression model and hence you can choose the model that give you high accuracy in prediction. The random forest lines of code is bunded in single chunk;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a><span class="do">## spliting</span></span>
<span id="cb42-2"><a href="#cb42-2"></a>my.split <span class="ot">=</span> diabetes.tidy <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3"></a>  <span class="fu">initial_split</span>(<span class="at">prop =</span> .<span class="dv">8</span>)</span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="do">## test set</span></span>
<span id="cb42-5"><a href="#cb42-5"></a>my.test <span class="ot">=</span> my.split <span class="sc">%&gt;%</span>  <span class="fu">testing</span>()</span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="do">## train set</span></span>
<span id="cb42-7"><a href="#cb42-7"></a>my.train <span class="ot">=</span> my.split <span class="sc">%&gt;%</span> <span class="fu">training</span>()</span>
<span id="cb42-8"><a href="#cb42-8"></a></span>
<span id="cb42-9"><a href="#cb42-9"></a><span class="co"># spefiy the model</span></span>
<span id="cb42-10"><a href="#cb42-10"></a>my.fit  <span class="ot">=</span> <span class="fu">rand_forest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb42-11"><a href="#cb42-11"></a>  <span class="fu">set_engine</span>(<span class="at">engine =</span> <span class="st">"ranger"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-12"><a href="#cb42-12"></a>  <span class="fu">set_mode</span>(<span class="at">mode =</span> <span class="st">"classification"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-13"><a href="#cb42-13"></a>  <span class="co"># fit the model</span></span>
<span id="cb42-14"><a href="#cb42-14"></a>  <span class="fu">fit</span>(diabetic <span class="sc">~</span> ., <span class="at">data =</span> my.train)</span>
<span id="cb42-15"><a href="#cb42-15"></a></span>
<span id="cb42-16"><a href="#cb42-16"></a><span class="co"># test the model</span></span>
<span id="cb42-17"><a href="#cb42-17"></a>my.prediction <span class="ot">=</span> my.fit <span class="sc">%&gt;%</span> </span>
<span id="cb42-18"><a href="#cb42-18"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> my.test)</span>
<span id="cb42-19"><a href="#cb42-19"></a></span>
<span id="cb42-20"><a href="#cb42-20"></a>my.prediction.prob  <span class="ot">=</span>  my.fit <span class="sc">%&gt;%</span> </span>
<span id="cb42-21"><a href="#cb42-21"></a>  <span class="fu">predict</span>(<span class="at">new_data =</span> my.test, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb42-22"><a href="#cb42-22"></a></span>
<span id="cb42-23"><a href="#cb42-23"></a>my.prediction <span class="ot">=</span>  my.prediction <span class="sc">%&gt;%</span> </span>
<span id="cb42-24"><a href="#cb42-24"></a>  <span class="fu">bind_cols</span>(my.prediction.prob)</span>
<span id="cb42-25"><a href="#cb42-25"></a></span>
<span id="cb42-26"><a href="#cb42-26"></a>my.result <span class="ot">=</span> my.test <span class="sc">%&gt;%</span> </span>
<span id="cb42-27"><a href="#cb42-27"></a>  <span class="fu">select</span>(diabetic) <span class="sc">%&gt;%</span> </span>
<span id="cb42-28"><a href="#cb42-28"></a>  <span class="fu">bind_cols</span>(my.prediction)</span>
<span id="cb42-29"><a href="#cb42-29"></a></span>
<span id="cb42-30"><a href="#cb42-30"></a><span class="co"># validate the model</span></span>
<span id="cb42-31"><a href="#cb42-31"></a></span>
<span id="cb42-32"><a href="#cb42-32"></a>my.result <span class="sc">%&gt;%</span> </span>
<span id="cb42-33"><a href="#cb42-33"></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> diabetic, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb42-34"><a href="#cb42-34"></a></span>
<span id="cb42-35"><a href="#cb42-35"></a>my.result <span class="sc">%&gt;%</span> </span>
<span id="cb42-36"><a href="#cb42-36"></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> diabetic, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb42-37"><a href="#cb42-37"></a></span>
<span id="cb42-38"><a href="#cb42-38"></a><span class="co"># Combine metrics and evaluate them all at once</span></span>
<span id="cb42-39"><a href="#cb42-39"></a>eval_metrics <span class="ot">&lt;-</span> </span>
<span id="cb42-40"><a href="#cb42-40"></a>  <span class="fu">metric_set</span>(ppv, recall, accuracy, f_meas)</span>
<span id="cb42-41"><a href="#cb42-41"></a></span>
<span id="cb42-42"><a href="#cb42-42"></a></span>
<span id="cb42-43"><a href="#cb42-43"></a><span class="fu">eval_metrics</span>(</span>
<span id="cb42-44"><a href="#cb42-44"></a>  <span class="at">data =</span> my.result, </span>
<span id="cb42-45"><a href="#cb42-45"></a>  <span class="at">truth =</span> diabetic, </span>
<span id="cb42-46"><a href="#cb42-46"></a>  <span class="at">estimate =</span> .pred_class</span>
<span id="cb42-47"><a href="#cb42-47"></a>  )</span>
<span id="cb42-48"><a href="#cb42-48"></a></span>
<span id="cb42-49"><a href="#cb42-49"></a><span class="do">## plotting</span></span>
<span id="cb42-50"><a href="#cb42-50"></a></span>
<span id="cb42-51"><a href="#cb42-51"></a>my.result <span class="sc">%&gt;%</span> </span>
<span id="cb42-52"><a href="#cb42-52"></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> diabetic, .pred_Diabetic) <span class="sc">%&gt;%</span> </span>
<span id="cb42-53"><a href="#cb42-53"></a>  <span class="fu">autoplot</span>()</span>
<span id="cb42-54"><a href="#cb42-54"></a></span>
<span id="cb42-55"><a href="#cb42-55"></a>my.result <span class="sc">%&gt;%</span> </span>
<span id="cb42-56"><a href="#cb42-56"></a>  <span class="fu">roc_auc</span>(<span class="at">truth =</span> diabetic, .pred_Diabetic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cited-materials" class="level2">




</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">Cited Materials</h2><div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="doc-bibliography">
<div id="ref-janitor" class="csl-entry" role="doc-biblioentry">
Firke, S. (2020). <em>Janitor: Simple tools for examining and cleaning dirty data</em>. Retrieved from <a href="https://CRAN.R-project.org/package=janitor">https://CRAN.R-project.org/package=janitor</a>
</div>
<div id="ref-rsample" class="csl-entry" role="doc-biblioentry">
Kuhn, M., Chow, F., &amp; Wickham, H. (2020). <em>Rsample: General resampling infrastructure</em>. Retrieved from <a href="https://CRAN.R-project.org/package=rsample">https://CRAN.R-project.org/package=rsample</a>
</div>
<div id="ref-yardstick" class="csl-entry" role="doc-biblioentry">
Kuhn, M., &amp; Vaughan, D. (2020). <em>Yardstick: Tidy characterizations of model performance</em>. Retrieved from <a href="https://CRAN.R-project.org/package=yardstick">https://CRAN.R-project.org/package=yardstick</a>
</div>
<div id="ref-tidymodels" class="csl-entry" role="doc-biblioentry">
Kuhn, M., &amp; Wickham, H. (2020). <em>Tidymodels: Easily install and load the ’tidymodels’ packages</em>. Retrieved from <a href="https://CRAN.R-project.org/package=tidymodels">https://CRAN.R-project.org/package=tidymodels</a>
</div>
<div id="ref-dplyr" class="csl-entry" role="doc-biblioentry">
Wickham, H., François, R., Henry, L., &amp; Müller, K. (2019). <em>Dplyr: A grammar of data manipulation</em>. Retrieved from <a href="https://CRAN.R-project.org/package=dplyr">https://CRAN.R-project.org/package=dplyr</a>
</div>
<div id="ref-readr" class="csl-entry" role="doc-biblioentry">
Wickham, H., Hester, J., &amp; Francois, R. (2017). <em>Readr: Read rectangular text data</em>. Retrieved from <a href="https://CRAN.R-project.org/package=readr">https://CRAN.R-project.org/package=readr</a>
</div>
<div id="ref-tidyverse" class="csl-entry" role="doc-biblioentry">
Wickham, H., &amp; Wickham, M. H. (2017). <em>Tidyverse: Easily install and load the ’tidyverse’</em>. Retrieved from <a href="https://CRAN.R-project.org/package=tidyverse">https://CRAN.R-project.org/package=tidyverse</a>
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>