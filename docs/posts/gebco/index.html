<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Masumbuko Semba">
<meta name="dcterms.date" content="2023-03-01">

<title>ng’ara - Getting GEBCO Bathymetry Data and glean the power of terra and tidyterra packages for raster and vector objects</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../ngara.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

<script type="text/javascript">

(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-127756435-1', 'auto');

ga('send', {
  hitType: 'pageview',
  'anonymizeIp': true,
});
</script>


<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="ng’ara - Getting GEBCO Bathymetry Data and glean the power of terra and tidyterra packages for raster and vector objects">
<meta name="twitter:description" content="As an Oceanography, one key parameter that need to get right is the bathymetry. Bathymetry is the science of determining the topography of the seafloor.">
<meta name="twitter:image" content="https://lugoga.github.io/semba-quarto/posts\gebco\thumbnail_blog.png">
<meta name="twitter:creator" content="@semba753">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">ng’ara</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html">
 <span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/lugoga"><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/semba2020"><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/channel/UC9uZ1KPyo7zIzI4BnUtHPfA"><i class="bi bi-youtube" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="../../blog.xml"><i class="bi bi-rss" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-apps--links" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Apps &amp; Links</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-apps--links">    
        <li>
    <a class="dropdown-item" href="https://semba.netlify.app/">
 <span class="dropdown-text">Semba-blog Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://semba-blog.netlify.app/">
 <span class="dropdown-text">Semba Data Analysis</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://semba.shinyapps.io/kwala/">
 <span class="dropdown-text">Kwala commercial CIty</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://semba.shinyapps.io/coastal_dashboard/">
 <span class="dropdown-text">Marine Hub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://nemp.shinyapps.io/nemp/">
 <span class="dropdown-text">Environmental Master Plan</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://semba.shinyapps.io/OceanWebApp/">
 <span class="dropdown-text">Hydrographic Data Hub</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://semba.shinyapps.io/marineTz/">
 <span class="dropdown-text">Potential Fishing Zones</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://lugoga.github.io/msp/">
 <span class="dropdown-text">Marine Spatial Planning</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://rweekly.org/">
 <span class="dropdown-text">R Weekly</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.r-bloggers.com/">
 <span class="dropdown-text">R Bloggers</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../../archive.html">
 <span class="menu-text">Archive</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#the-modern-approach" id="toc-the-modern-approach" class="nav-link" data-scroll-target="#the-modern-approach">The modern approach</a></li>
  <li><a href="#cited-materials" id="toc-cited-materials" class="nav-link" data-scroll-target="#cited-materials">Cited Materials</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Getting GEBCO Bathymetry Data and glean the power of terra and tidyterra packages for raster and vector objects</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Manipulation</div>
    <div class="quarto-category">Visualization</div>
    <div class="quarto-category">R</div>
  </div>
  </div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <a href="https://semba.netlify.app">Masumbuko Semba</a> <a href="https://orcid.org/0000-0002-5002-9747" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a>
  </div>
    <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://semba.netlify.app/">
            Nelson Mandela African Institution of Science and Technology
            </a>
          </p>
      </div>
    </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 1, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>As an Oceanography, one key parameter that need to get right is the bathymetry. Bathymetry is the science of determining the topography of the seafloor. Bathymetry data is used to generate navigational charts, seafloor profile, biological oceanography, beach erosion, sea-level rise, etc. There pretty of bathymetry data and one of the them is the GEBCO Gridded Bathymetry Data. In this post we are going to learn how to access the bathymetry dataset from GEBCO website, import the dataset into R session and make plots to reveal the elevation and bathymetry of the Pemba Channel. In addtional, the post provide an glimpse of the new packages for handling raster dataset in R. The packages I am goint to introduce to you are <em>terra</em> and <strong>tidyterra</strong>, that have changed the way R handles raster and vector objet and improved both the processing of raster objects and visualization.</p>
</section>
<section id="dataset" class="level2">
<h2 class="anchored" data-anchor-id="dataset">Dataset</h2>
<p>The General bathymetric Chart of the Oceans (GEBCO) consists of an international group of experts in ocean mapping. This team provides the most authoritative publicly-available bathymetry of the world’s oceans. In this post i will illustrate how to download data from their website and use for mapping. You can obtain the data for your region of interest or for the global oceans. You can download the data from <a href="https://download.gebco.net/">GEBCO</a>. For this case I have downloaded the data for East African Coast as netCDF file by specifying the geogrpahical extent and choose the file type as shown in <a href="#fig-gebco">Figure&nbsp;1</a>.</p>
<div class="cell">
<div class="cell-output-display">
<div id="fig-gebco" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="gebco.jpg" class="img-fluid figure-img" style="width:100.0%"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: The gateway screenshot for accessing bathymetric dataset for any region in the world</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>To process the data and visualize in maps, we need several packages highlighted in the chunk below. You need to load the packages in your session first. If not in your machine, you need to install them first.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">require</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">require</span>(ncdf4)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">require</span>(sf)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">require</span>(metR)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then read the file using <code>nc_open</code> function of the <strong>ncdf4</strong> package <span class="citation" data-cites="ncdf4">(<a href="#ref-ncdf4" role="doc-biblioref">Pierce 2017</a>)</span> and print the file to see the metadata that describe the variables that are embedded in the file.</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>nc <span class="ot">=</span> <span class="fu">nc_open</span>(<span class="st">"d:/gebco_tz.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>nc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>File d:/semba/shapefile/gebco/gebco_2021_n2.0_s-15.0_w35.0_e50.0.nc (NC_FORMAT_CLASSIC):

     1 variables (excluding dimension variables):
        short elevation[lon,lat]   
            standard_name: height_above_mean_sea_level
            long_name: Elevation relative to sea level
            units: m
            grid_mapping: crs
            sdn_parameter_urn: SDN:P01::ALATZZ01
            sdn_parameter_name: Sea floor height (above mean sea level) {bathymetric height}
            sdn_uom_urn: SDN:P06::ULAA
            sdn_uom_name: Metres

     2 dimensions:
        lat  Size:4080 
            standard_name: latitude
            long_name: latitude
            units: degrees_north
            axis: Y
            sdn_parameter_urn: SDN:P01::ALATZZ01
            sdn_parameter_name: Latitude north
            sdn_uom_urn: SDN:P06::DEGN
            sdn_uom_name: Degrees north
        lon  Size:3600 
            standard_name: longitude
            long_name: longitude
            units: degrees_east
            axis: X
            sdn_parameter_urn: SDN:P01::ALONZZ01
            sdn_parameter_name: Longitude east
            sdn_uom_urn: SDN:P06::DEGE
            sdn_uom_name: Degrees east

    36 global attributes:
        title: The GEBCO_2021 Grid - a continuous terrain model for oceans and land at 15 arc-second intervals
        summary: The GEBCO_2021 Grid is a continuous, global terrain model for ocean and land with a spatial resolution of 15 arc seconds.The grid uses as a 'base-map' Version 2.2 of the SRTM15+ data set (Tozer et al, 2019). This data set is a fusion of land topography with measured and estimated seafloor topography. It is augmented with gridded bathymetric data sets developed as part of the Nippon Foundation-GEBCO Seabed 2030 Project.
        keywords: BATHYMETRY/SEAFLOOR TOPOGRAPHY, DIGITAL ELEVATION/DIGITAL TERRAIN MODELS
        Conventions: CF-1.6, ACDD-1.3
        id: DOI: 10.5285/c6612cbe-50b3-0cff-e053-6c86abc09f8f
        naming_authority: https://dx.doi.org
        history: Information on the development of the data set and the source data sets included in the grid can be found in the data set documentation available from https://www.gebco.net
        source: The GEBCO_2021 Grid is the latest global bathymetric product released by the General Bathymetric Chart of the Oceans (GEBCO) and has been developed through the Nippon Foundation-GEBCO Seabed 2030 Project. This is a collaborative project between the Nippon Foundation of Japan and GEBCO. The Seabed 2030 Project aims to bring together all available bathymetric data to produce the definitive map of the world ocean floor and make it available to all.
        comment: The data in the GEBCO_2021 Grid should not be used for navigation or any purpose relating to safety at sea.
        license: The GEBCO Grid is placed in the public domain and may be used free of charge. Use of the GEBCO Grid indicates that the user accepts the conditions of use and disclaimer information: https://www.gebco.net/data_and_products/gridded_bathymetry_data/gebco_2019/grid_terms_of_use.html
        date_created: 2021-07-01
        creator_name: GEBCO through the Nippon Foundation-GEBCO Seabed 2030 Project
        creator_email: gdacc@seabed2030.org
        creator_url: https://www.gebco.net
        institution: On behalf of the General Bathymetric Chart of the Oceans (GEBCO), the data are held at the British Oceanographic Data Centre (BODC).
        project: Nippon Foundation - GEBCO Seabed2030 Project
        creator_type: International organisation
        geospatial_bounds: -180
         geospatial_bounds: -90
         geospatial_bounds: 180
         geospatial_bounds: 90
        geospatial_bounds_crs: WGS84
        geospatial_bounds_vertical_crs: EPSG:5831
        geospatial_lat_min: -90
        geospatial_lat_max: 90
        geospatial_lat_units: degrees_north
        geospatial_lat_resolution: 0.00416666666666667
        geospatial_lon_min: -180
        geospatial_lon_max: 180
        geospatial_lon_units: degrees_east
        geospatial_lon_resolution: 0.00416666666666667
        geospatial_vertical_min: -10977
        geospatial_vertical_max: 8685
        geospatial_vertical_units: meters
        geospatial_vertical_resolution: 1
        geospatial_vertical_positive: up
        identifier_product_doi: DOI: 10.5285/c6612cbe-50b3-0cff-e053-6c86abc09f8f
        references: DOI: 10.5285/c6612cbe-50b3-0cff-e053-6c86abc09f8f
        node_offset: 1</code></pre>
</div>
</div>
<p>Looking on the metadata, we notice that there are three variables we need to extract from the file, these are longitude, latitude and depth. We use a <code>ncvar_get</code> function from <strong>ncdf4</strong> <span class="citation" data-cites="ncdf4">(<a href="#ref-ncdf4" role="doc-biblioref">Pierce 2017</a>)</span> package to extract these variables. Note the name parsed in the function as should written as they appear in the metadata.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>lat <span class="ot">=</span> <span class="fu">ncvar_get</span>(nc, <span class="st">"lat"</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>lon <span class="ot">=</span> <span class="fu">ncvar_get</span>(nc, <span class="st">"lon"</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a>bathy <span class="ot">=</span> <span class="fu">ncvar_get</span>(nc, <span class="st">"elevation"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we can check the type of the file using a <code>class</code> function</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="fu">class</span>(bathy); <span class="fu">class</span>(lon); <span class="fu">class</span>(lat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "matrix" "array" </code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "array"</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "array"</code></pre>
</div>
</div>
<p>We notice these objects comes as array. we can check the size also</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="fu">dim</span>(lon); <span class="fu">dim</span>(lat);<span class="fu">dim</span>(bathy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3600</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4080</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3600 4080</code></pre>
</div>
</div>
<p>We also notice that while lon and lat object are array, but they are vector and only bathy is the matrix. Therefore, we need to make a data frame so that we can make plots using ggplot package, which only work in the dataset that is organized as data.frame or tibble. That can be done using a <code>expand.grid</code> function. First we expand the lon and lat file followed with the bathy and combine them to make a tibble as the chunk below highlight. Because of the file size, only bathymetric values that fall within the pemba Channel were selected.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>dataset <span class="ot">=</span> <span class="fu">expand.grid</span>(lon, lat) <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2"></a>  <span class="fu">bind_cols</span>(<span class="fu">expand.grid</span>(bathy)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4"></a>  <span class="fu">rename</span>(<span class="at">lon =</span> <span class="dv">1</span>, <span class="at">lat =</span> <span class="dv">2</span>, <span class="at">depth =</span> <span class="dv">3</span>)<span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="#cb14-5"></a>  <span class="fu">filter</span>(lon <span class="sc">&gt;</span><span class="fl">38.5</span> <span class="sc">&amp;</span> lon <span class="sc">&lt;</span> <span class="fl">40.5</span> <span class="sc">&amp;</span> lat <span class="sc">&gt;</span> <span class="sc">-</span><span class="fl">5.8</span> <span class="sc">&amp;</span> lat <span class="sc">&lt;</span> <span class="sc">-</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Separate the dataset into the land and ocean based on zero (0) value as reference point, where the above sea level topography values are assumed</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>land <span class="ot">=</span> dataset <span class="sc">%&gt;%</span> <span class="fu">filter</span>(depth <span class="sc">&gt;</span><span class="dv">0</span> )</span>
<span id="cb15-2"><a href="#cb15-2"></a>ocean <span class="ot">=</span> dataset <span class="sc">%&gt;%</span> <span class="fu">filter</span>(depth <span class="sc">&lt;=</span> <span class="dv">0</span> )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Load the basemap shapefile</p>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>africa <span class="ot">=</span> <span class="fu">st_read</span>(<span class="st">"d:/africa.shp"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Make a color of land and depth that we will use later for mapping the topography and bathymetry, respectively.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co">#make palette</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>ocean.pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#000000"</span>, <span class="st">"#000413"</span>, <span class="st">"#000728"</span>, <span class="st">"#002650"</span>, <span class="st">"#005E8C"</span>, <span class="st">"#0096C8"</span>, <span class="st">"#45BCBB"</span>, <span class="st">"#8AE2AE"</span>, <span class="st">"#BCF8B9"</span>, <span class="st">"#DBFBDC"</span>)</span>
<span id="cb17-3"><a href="#cb17-3"></a>land.pal <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"#467832"</span>, <span class="st">"#887438"</span>, <span class="st">"#B19D48"</span>, <span class="st">"#DBC758"</span>, <span class="st">"#FAE769"</span>, <span class="st">"#FAEB7E"</span>, <span class="st">"#FCED93"</span>, <span class="st">"#FCF1A7"</span>, <span class="st">"#FCF6C1"</span>, <span class="st">"#FDFAE0"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can plot the bathymetry shown in @ fig-bathy with the code highlighted in the chunk below</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>  metR<span class="sc">::</span><span class="fu">geom_contour_fill</span>(<span class="at">data =</span> ocean, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">z =</span> depth), </span>
<span id="cb18-3"><a href="#cb18-3"></a>                          <span class="at">bins =</span> <span class="dv">120</span>, <span class="at">global.breaks =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb18-4"><a href="#cb18-4"></a>  metR<span class="sc">::</span><span class="fu">geom_contour2</span>(<span class="at">data =</span> ocean, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">z =</span> depth, </span>
<span id="cb18-5"><a href="#cb18-5"></a>                                        <span class="at">label =</span> ..level..), <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">200</span>,<span class="sc">-</span><span class="dv">600</span>), <span class="at">skip =</span> <span class="dv">0</span> )<span class="sc">+</span></span>
<span id="cb18-6"><a href="#cb18-6"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> ocean.pal, <span class="at">name =</span> <span class="st">"Depth (m)"</span>, </span>
<span id="cb18-7"><a href="#cb18-7"></a>                       <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">1800</span>,<span class="dv">0</span>,<span class="dv">300</span>), <span class="at">label =</span> <span class="fu">seq</span>(<span class="dv">1800</span>,<span class="dv">0</span>,<span class="sc">-</span><span class="dv">300</span>))<span class="sc">+</span></span>
<span id="cb18-8"><a href="#cb18-8"></a>  ggspatial<span class="sc">::</span><span class="fu">layer_spatial</span>(<span class="at">data =</span> africa)<span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">38.9</span>,<span class="dv">40</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">5.6</span>,<span class="sc">-</span><span class="fl">4.1</span>))<span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-bathy" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-bathy-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Bathymetry of the Pemba Channel, solid lines are contour lines</figcaption><p></p>
</figure>
</div>
</div>
</div>
<p>Similary, we can plot togopgraphy of the area shown in <a href="#fig-bathy2">Figure&nbsp;3</a> using the code shown below</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>  metR<span class="sc">::</span><span class="fu">geom_contour_fill</span>(<span class="at">data =</span> land, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">z =</span> depth), </span>
<span id="cb19-3"><a href="#cb19-3"></a>                          <span class="at">bins =</span> <span class="dv">120</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4"></a>  metR<span class="sc">::</span><span class="fu">geom_contour2</span>(<span class="at">data =</span> land, <span class="fu">aes</span>(<span class="at">x =</span> lon, <span class="at">y =</span> lat, <span class="at">z =</span> depth), </span>
<span id="cb19-5"><a href="#cb19-5"></a>                      <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">200</span>), <span class="at">skip =</span> <span class="dv">0</span> )<span class="sc">+</span></span>
<span id="cb19-6"><a href="#cb19-6"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colours =</span> land.pal, <span class="at">name =</span> <span class="st">"Topography"</span>, </span>
<span id="cb19-7"><a href="#cb19-7"></a>                       <span class="at">trans =</span> scales<span class="sc">::</span><span class="fu">sqrt_trans</span>())<span class="sc">+</span></span>
<span id="cb19-8"><a href="#cb19-8"></a>  ggspatial<span class="sc">::</span><span class="fu">layer_spatial</span>(<span class="at">data =</span> africa, <span class="at">fill =</span> <span class="cn">NA</span>)<span class="sc">+</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">38.9</span>,<span class="dv">40</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">5.6</span>,<span class="sc">-</span><span class="fl">4.1</span>))<span class="sc">+</span></span>
<span id="cb19-10"><a href="#cb19-10"></a>  <span class="fu">theme_bw</span>(<span class="at">base_size =</span> <span class="dv">12</span>)<span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-bathy2" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-bathy2-1.png" class="img-fluid figure-img" width="672"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Elevation near the Pemba Channel, solid lines are contour lines</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-modern-approach" class="level2">
<h2 class="anchored" data-anchor-id="the-modern-approach">The modern approach</h2>
<p>In R ecosystem, the traditional handling of spatial data– raster and vector has changed dramatically in recent years. The widely used <strong>raster</strong> <span class="citation" data-cites="raster">(<a href="#ref-raster" role="doc-biblioref">Hijmans 2017</a>)</span> and <strong>sp</strong> <span class="citation" data-cites="sp">(<a href="#ref-sp" role="doc-biblioref">Bivand, Pebesma, and Gomez-Rubio 2013</a>)</span> packages dominated spatial analysis in R for decades. This has changed recent with the introduction of new and more convinient packages. These packages include <strong>terra</strong>, which has functions for creating, reading, manipulating, and writing raster data <span class="citation" data-cites="terra">(<a href="#ref-terra" role="doc-biblioref">Hijmans 2022</a>)</span>. The <strong>terra</strong> package provides, among other things, general raster data manipulation functions that can easily be used to develop more specific functions. The package also implements raster algebra and most functions for raster data manipulation.</p>
<p>terra replaces the raster package. The interfaces of terra and raster are similar, but terra is simpler, faster and can do more. The sister package to <strong>terra</strong> is <strong>tidyterra</strong> <span class="citation" data-cites="tidyterra">(<a href="#ref-tidyterra" role="doc-biblioref">Hernangómez 2023</a>)</span>. <strong>tidyterra</strong> is a package that add common methods from the <strong>tidyverse</strong> <span class="citation" data-cites="tidyverse">(<a href="#ref-tidyverse" role="doc-biblioref">Wickham and Wickham 2017</a>)</span> for SpatRaster and SpatVectors objects created with the <strong>terra</strong> package. It also adds specific <code>geom_spat*()</code> functions for plotting these kind of objects with <strong>ggplot2</strong> <span class="citation" data-cites="ggplot">(<a href="#ref-ggplot" role="doc-biblioref">Wickham 2016</a>)</span>.</p>
<p>Let’s load the packages</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="fu">require</span>(terra)</span>
<span id="cb20-2"><a href="#cb20-2"></a><span class="fu">require</span>(tidyterra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then we use a function <code>rast</code> from <strong>terra</strong> package to read raster file from the working directory of the local machine.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>gebco <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">"gebco.nc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<p>Then we print the the bathymetry file that we just imported</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>gebco</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 4080, 3600, 1  (nrow, ncol, nlyr)
resolution  : 0.004166667, 0.004166667  (x, y)
extent      : 35, 50, -15, 2  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat WGS 84 
source      : gebco_2021_n2.0_s-15.0_w35.0_e50.0.nc 
varname     : elevation (Elevation relative to sea level) 
name        : elevation 
unit        :         m </code></pre>
</div>
</div>
<p>The printed output is the metadata of the spatRaster with information that can assist to clear understand the file. I am not going into detail into it but he <code>coord. ref.</code> field shows <code>lon/lat WGS 84</code>, which is Geographic Coordinates with Datum WGS 84. If you just want to know the CRS from a <code>SpatRaster</code>, you just call <code>crs()</code> You also notice that the <code>varname</code> is the elevation, but in fact this dataset contain the altitude (elevation) for land and depth (bathymetry) for ocean and the unit of the measurement are in meters. Since the dataset is the raste, it provide the grid resolution of 0.004166667 degree, which is equivalent to a spatial resolution of 500 meters grid.</p>
<p>The geographical extent of the file is quite big range from longitude 35 to 50 and latitude -15 to 2. Since we only focus for the Pemba Channel, we need to crop the spatRaster to our area of interest. <strong>terra</strong> package has <code>crop</code> function for that but, thi function requires us to purse a file that has defined geographical extent. The extent can easily defined using <code>ext</code> function, also from <strong>terra</strong> package. The geographical extent of our area ranged from longitude 38 to 41 and latitude -6.2 to -3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>pemba.ext <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">ext</span>(<span class="dv">38</span>,<span class="dv">41</span>,<span class="sc">-</span><span class="fl">6.2</span>,<span class="sc">-</span><span class="fl">3.8</span>)</span>
<span id="cb24-2"><a href="#cb24-2"></a></span>
<span id="cb24-3"><a href="#cb24-3"></a>gebco.pemba <span class="ot">=</span> terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb24-4"><a href="#cb24-4"></a>  <span class="at">x =</span> gebco, </span>
<span id="cb24-5"><a href="#cb24-5"></a>  <span class="at">y =</span> pemba.ext</span>
<span id="cb24-6"><a href="#cb24-6"></a>  )</span>
<span id="cb24-7"><a href="#cb24-7"></a></span>
<span id="cb24-8"><a href="#cb24-8"></a>gebco.pemba</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>class       : SpatRaster 
dimensions  : 576, 720, 1  (nrow, ncol, nlyr)
resolution  : 0.004166667, 0.004166667  (x, y)
extent      : 38, 41, -6.2, -3.8  (xmin, xmax, ymin, ymax)
coord. ref. : lon/lat WGS 84 
source(s)   : memory
name        : elevation 
min value   :     -2610 
max value   :      2247 </code></pre>
</div>
</div>
<p>The printed metadata indicated that the geographical extent meet what we defined above but it also provide the minimum and maximum values of the bathymetry and elevation values. <strong>tidyterra</strong> makes us use similar verbs of tidyverse to raster objects similar to tibble objects. For example, in the Pemba.gebco we can first filter and strip all elevation grid (elevation &gt;0) and rename the elevation into depth with <code>rename</code> function and then use <code>as.data.frame</code> function from <strong>terra</strong> to convert spatRaster object to tibble. The chunk below summarise the above explanation;</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>gebco.pemba.tb <span class="ot">=</span> gebco.pemba <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2"></a>  tidyterra<span class="sc">::</span><span class="fu">filter</span>(elevation <span class="sc">&lt;=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3"></a>  tidyterra<span class="sc">::</span><span class="fu">rename</span>(<span class="at">depth =</span> elevation) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4"></a>  terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In addition of making tidyverse verbs that suits for tibble for manipulation of raster objects, <strong>tidyterra</strong> brings function for plotting raster object with <strong>ggplot2</strong>. A <code>geom_spatraster</code> function has enabled ability of plotting both elevation and bathymetry with color gradient that distinguish these layers in a more appealing form. It also has <code>geom_spatraster_contour</code> function for plotting contour from raster in <strong>ggplot</strong>. Simple feature and shapefile are also plotted with <code>geom_spatvector</code> function. The chunk below contains lines that illustrates the above explanation and rendered to generate <a href="#fig-fig4">Figure&nbsp;4</a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-2"><a href="#cb27-2"></a>  <span class="fu">geom_spatraster</span>(<span class="at">data =</span> gebco.pemba, <span class="at">show.legend =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3"></a>  <span class="fu">geom_spatraster_contour</span>(<span class="at">data =</span> gebco.pemba, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">200</span>), </span>
<span id="cb27-4"><a href="#cb27-4"></a>                          <span class="at">linewidth =</span> <span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5"></a>  <span class="fu">geom_spatvector</span>(<span class="at">data =</span> africa, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"black"</span>)<span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6"></a>  <span class="fu">geom_sf_text</span>(<span class="at">data =</span> africa, <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">str_to_upper</span>(CNTRY_NAME)), </span>
<span id="cb27-7"><a href="#cb27-7"></a>               <span class="at">size =</span> <span class="fl">2.3</span>, <span class="at">check_overlap =</span> <span class="cn">TRUE</span>)<span class="sc">+</span></span>
<span id="cb27-8"><a href="#cb27-8"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">38.9</span>,<span class="dv">40</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">5.6</span>,<span class="sc">-</span><span class="fl">4.1</span>))<span class="sc">+</span></span>
<span id="cb27-9"><a href="#cb27-9"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb27-10"><a href="#cb27-10"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"right"</span>, <span class="at">axis.title =</span> <span class="fu">element_blank</span>())<span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_north_arrow</span>(<span class="at">location =</span> <span class="st">"tr"</span>, </span>
<span id="cb27-12"><a href="#cb27-12"></a>                                    <span class="at">height =</span> <span class="fu">unit</span>(<span class="fl">1.5</span>, <span class="st">"cm"</span>),</span>
<span id="cb27-13"><a href="#cb27-13"></a>                                    <span class="at">width =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>),</span>
<span id="cb27-14"><a href="#cb27-14"></a>                                    <span class="at">pad_x =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">"cm"</span>),</span>
<span id="cb27-15"><a href="#cb27-15"></a>                                    <span class="at">pad_y =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">"cm"</span>),</span>
<span id="cb27-16"><a href="#cb27-16"></a>                                    <span class="at">rotation =</span> <span class="cn">NULL</span>)<span class="sc">+</span></span>
<span id="cb27-17"><a href="#cb27-17"></a>  ggspatial<span class="sc">::</span><span class="fu">annotation_scale</span>(<span class="at">location =</span> <span class="st">"bl"</span>)<span class="sc">+</span></span>
<span id="cb27-18"><a href="#cb27-18"></a>  <span class="fu">scale_fill_hypso_tint_c</span>(</span>
<span id="cb27-19"><a href="#cb27-19"></a>    <span class="at">palette =</span> <span class="st">"gmt_globe"</span>,</span>
<span id="cb27-20"><a href="#cb27-20"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">big.mark =</span> <span class="st">","</span>),</span>
<span id="cb27-21"><a href="#cb27-21"></a>    <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">2000</span>,<span class="dv">2000</span>),</span>
<span id="cb27-22"><a href="#cb27-22"></a>    <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3000</span>,<span class="dv">3000</span>,<span class="dv">500</span>),</span>
<span id="cb27-23"><a href="#cb27-23"></a>    <span class="at">guide =</span> <span class="fu">guide_colorbar</span>(</span>
<span id="cb27-24"><a href="#cb27-24"></a>      <span class="at">title =</span> <span class="st">"Bathymetry and Elevation"</span>,</span>
<span id="cb27-25"><a href="#cb27-25"></a>      <span class="at">title.hjust =</span> .<span class="dv">5</span>,</span>
<span id="cb27-26"><a href="#cb27-26"></a>      <span class="at">direction =</span> <span class="st">"vertical"</span>,</span>
<span id="cb27-27"><a href="#cb27-27"></a>      <span class="at">title.position =</span> <span class="st">"right"</span>,</span>
<span id="cb27-28"><a href="#cb27-28"></a>      <span class="at">title.theme =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>),</span>
<span id="cb27-29"><a href="#cb27-29"></a>      <span class="at">barheight =</span> <span class="dv">10</span>,</span>
<span id="cb27-30"><a href="#cb27-30"></a>      <span class="at">barwidth =</span> .<span class="dv">60</span>)</span>
<span id="cb27-31"><a href="#cb27-31"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-fig4" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="index_files/figure-html/fig-fig4-1.png" class="img-fluid figure-img" width="576"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: Bathymetry and elevation of the Pemba Channel. Solid black line is an isobar contour of 200 meter</figcaption><p></p>
</figure>
</div>
</div>
</div>
</section>
<section id="cited-materials" class="level2">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">Cited Materials</h2><div id="refs" class="references csl-bib-body hanging-indent" role="doc-bibliography">
<div id="ref-sp" class="csl-entry" role="doc-biblioentry">
Bivand, Roger S., Edzer Pebesma, and Virgilio Gomez-Rubio. 2013. <em>Applied Spatial Data Analysis with <span>R</span>, Second Edition</em>. Springer, NY. <a href="https://asdar-book.org/">https://asdar-book.org/</a>.
</div>
<div id="ref-tidyterra" class="csl-entry" role="doc-biblioentry">
Hernangómez, Diego. 2023. <em><span class="nocase">tidyterra</span>: Tidyverse Methods and Ggplot2 Helpers for Terra Objects</em> (version 0.3.1). <a href="https://doi.org/10.5281/zenodo.6572471">https://doi.org/10.5281/zenodo.6572471</a>.
</div>
<div id="ref-raster" class="csl-entry" role="doc-biblioentry">
Hijmans, Robert J. 2017. <em>Raster: Geographic Data Analysis and Modeling</em>. <a href="https://CRAN.R-project.org/package=raster">https://CRAN.R-project.org/package=raster</a>.
</div>
<div id="ref-terra" class="csl-entry" role="doc-biblioentry">
———. 2022. <em>Terra: Spatial Data Analysis</em>. <a href="https://CRAN.R-project.org/package=terra">https://CRAN.R-project.org/package=terra</a>.
</div>
<div id="ref-ncdf4" class="csl-entry" role="doc-biblioentry">
Pierce, David. 2017. <em>Ncdf4: Interface to Unidata netCDF (Version 4 or Earlier) Format Data Files</em>. <a href="https://CRAN.R-project.org/package=ncdf4">https://CRAN.R-project.org/package=ncdf4</a>.
</div>
<div id="ref-ggplot" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley. 2016. <em>Ggplot2: Elegant Graphics for Data Analysis</em>. Springer-Verlag New York. <a href="https://ggplot2.tidyverse.org">https://ggplot2.tidyverse.org</a>.
</div>
<div id="ref-tidyverse" class="csl-entry" role="doc-biblioentry">
Wickham, Hadley, and Maintainer Hadley Wickham. 2017. <em>Tidyverse: Easily Install and Load the ’Tidyverse’</em>. <a href="https://CRAN.R-project.org/package=tidyverse">https://CRAN.R-project.org/package=tidyverse</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>