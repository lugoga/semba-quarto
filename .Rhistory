)+
metR::geom_contour_fill(bins = 120)+
metR::geom_contour2(aes(label = ..level..)) +
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mgm^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.5,-5.5))+
facet_wrap(~time, nrow = 1) +
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
knitr::include_graphics("chatgpt_snippet.png")
knitr::include_graphics("vizingaPage.png")
#| label: fig-home
#| fig-cap: The home page of cage aquaculture web application in Lake Victoria
#| out-width: "100%"
knitr::include_graphics("weatherPage.png")
quarto::quarto_render()
require(terra)
require(tidyterra)
require(tidyverse)
require(sf)
require(magrittr)
require(patchwork)
tmax = raster::getData(name = 'worldclim', var = 'tmax', res = 10)
install.packages("geodata")
tmax
geodata::country_codes()
geodata::country_codes() %>% janitor::clean_names()
geodata::country_codes() %>% janitor::clean_names() %>% arrange(-name)
geodata::country_codes() %>% janitor::clean_names() %>% arrange(-name)
geodata::country_codes() %>% janitor::clean_names() %>% arrange(name)
geodata::country_codes() %>% janitor::clean_names() %>% arrange(desc(name))
geodata::country_codes() %>% janitor::clean_names() %>% arrange(asc(name))
geodata::country_codes() %>% janitor::clean_names() %>% arrange(-asc(name))
geodata::country_codes() %>% janitor::clean_names()
geodata::worldclim_country(country = "TZA", var = "tmax")
date
today
lubridate::today()
#| echo: false
#| label: fig-chat1
#| fig-cap: ChatGPT code for access and dowloading chlrophyll-a in the Pemba Channel
#| out-width: "100%"
knitr::include_graphics("chatgpt_snippet.png")
#| warning: false
#| message: false
#| comment: ""
library(rerddap)
library(tidyverse)
chl = rerddap::griddap(
x = "erdMH1chla8day",
longitude = c(38, 39.5),
latitude = c(-6.5,-5.5),
time = c("2022-01-01", "2022-01-31"),
fmt = "csv") %>%
dplyr::as_tibble() %>%
dplyr::mutate(time = lubridate::as_date(time))
chl
#| echo: false
tz = sf::st_read("tz.gpkg", quiet = TRUE)
#| warning: false
#| message: false
#| comment: ""
#| label: fig-chl
#| fig-cap: Chlorophyll-a concentration in the Pemba Channel
ggplot(
data = chl %>% filter(time < "2022-01-16"),
aes(x = longitude, y = latitude, z = chlorophyll)
)+
metR::geom_contour_fill(bins = 120)+
metR::geom_contour2(aes(label = ..level..)) +
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = "Chl-a\n(mgm^3)")+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.5,-5.5))+
facet_wrap(~time, nrow = 1) +
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
chl
chl %>% filter(time < "2021-12-31")
chl %>% filter(time == "2021-12-31")
chl %>% filter(time == "2021-12-31") %>%
select(-time)
chl %>% filter(time == "2021-12-31") %>%
select(-time) %>%
terra::rast()
chl %>% filter(time == "2021-12-31") %>%
select(-time) %>%
raster::rasterFromXYZ(crs = 4326)
chl %>% filter(time == "2021-12-31") %>%
select(-time)
chl %>% filter(time == "2021-12-31") %>%
select(-time) %>%
distinct(latitude)
chl %>% filter(time == "2021-12-31") %>%
select(-time) %>%
distinct(longitude)
chl %>% filter(time == "2021-12-31") %>%
select(-time) %>%
distinct(longitude, latitude)
chl %>% filter(time == "2021-12-31") %>%
select(-time) %>%
distinct(longitude)
25*37
chl %>% filter(time == "2021-12-31") %>%
select(-time) %>%
matrix(nrow = 37, ncol = 25)
matrix(nrow = 37, ncol = 25)
matrix(nrow = 37, ncol = 25) %>%
terra::rast()
matrix(nrow = 37, ncol = 25)
matrix(nrow = 37, ncol = 25) %>%
terra::rast()
aa = matrix(nrow = 37, ncol = 25) %>%
terra::rast()
raster::xmin(aa)
chl %>% filter(time == "2021-12-31") %>%
select(-time) %>% range(latitude)
require(magrittr)
chl %>% filter(time == "2021-12-31") %>%
select(-time) %$% range(latitude)
latRange = chl %>% filter(time == "2021-12-31") %>%
select(-time) %$% range(latitude)
lonRange = chl %>% filter(time == "2021-12-31") %>%
select(-time) %$% range(longitude)
raster::xmin(aa)
raster::xmin(aa) = lonRange[1]
lonRange[1]
aa
new_ext = terra::ext(lonRange[1],lonRange[2],latRange[1], latRange[2])
new_ext
terra::ext(aa)
terra::ext(aa) = new_ext
aa
-6.5--5.5
38-39.5
chl = rerddap::griddap(
x = "erdMH1chla8day",
longitude = c(38, 39.5),
latitude = c(-6.5,-5.0),
time = c("2022-01-01", "2022-01-31"),
fmt = "csv") %>%
dplyr::as_tibble() %>%
dplyr::mutate(time = lubridate::as_date(time))
chl
chl %>% filter(time == "2021-12-31") %>%
select(-time)
chl %>% filter(time == "2021-12-31") %>%
select(-time) %>%
distinct(longitude)
chl %>% filter(time == "2021-12-31") %>%
select(-time) %>%
distinct(latitude)
chl %>%
filter(time == "2021-12-31") %>%
select(-time)
chl %>%
filter(time == "2021-12-31") %>%
select(-time) %>%
terra::rast()
chl %>%
filter(time == "2021-12-31") %>%
select(-time) %>%
raster::rasterFromXYZ()
latRange = chl %>% filter(time == "2021-12-31") %>%
select(-time) %$% range(latitude)
lonRange = chl %>% filter(time == "2021-12-31") %>%
select(-time) %$% range(longitude)
aa = matrix(nrow = 37, ncol = 37) %>%
terra::rast()
aa
new_ext = terra::ext(lonRange[1],lonRange[2],latRange[1], latRange[2])
terra::ext(aa) = new_ext
aa
0.04054054*110
zvalue = chl %>%
filter(time == "2021-12-31") %>%
pull(chlorophyll)
zvalue
terra::set.values(aa, zvalue)
zvalue
terra::set.values(x = aa, value = zvalue)
terra::setValues(x = aa, values = zvalue)
aa.values = terra::setValues(x = aa, values = zvalue)
aa.values
plot(aa.values)
require(magrittr)
require(terra)
require(tidyterra)
plot(aa.values)
ggplot()+
geom_spatraster(data = aa.values)
ggplot()+
geom_spatraster(data = aa.values)+
metR::geom_contour2(aes(label = ..level..)) +
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = "Chl-a\n(mgm^3)")+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.5,-5.5))+
facet_wrap(~time, nrow = 1) +
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values)+
metR::geom_contour2(aes(label = ..level..)) +
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = "Chl-a\n(mgm^3)")+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.5,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = "Chl-a\n(mgm^3)")+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.5,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = "Chl-a\n(mgm^3)")+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.3,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = "Chl-a\n(mgm^3)")+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl~a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values, maxcell = 500)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values, maxcell = 50)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values, maxcell = 5000)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values, maxcell = 2000)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
aa.values
ggplot()+
geom_spatraster(data = aa.values, maxcell = 000)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values, maxcell = 100)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = aa.values, maxcell = 500)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
latRange
lonLength = chl %>% filter(time == "2021-12-31") %>% pull(longitude)
lonLength
latLength = chl %>% filter(time == "2021-12-31") %>% pull(latitude) %>% length()
latLength
lonLength = chl %>% filter(time == "2021-12-31") %>% distinct(longitude) %>% pull(longitude) %>% length()
lonLength
latLength = chl %>% filter(time == "2021-12-31") %>% distinct(latitu) %>% pull(latitude) %>% length()
latLength = chl %>% filter(time == "2021-12-31") %>% distinct(latitude) %>% pull(latitude) %>% length()
latLength
aa = matrix(nrow = lonLength, ncol = latLength) %>%
terra::rast()
aa
latRange = chl %>% filter(time == "2021-12-31") %>%
select(-time) %$% range(latitude)
latLength = chl %>% filter(time == "2021-12-31") %>% distinct(latitude) %>% pull(latitude) %>% length()
lonRange = chl %>% filter(time == "2021-12-31") %>%
select(-time) %$% range(longitude)
lonLength = chl %>% filter(time == "2021-12-31") %>% distinct(longitude) %>% pull(longitude) %>% length()
zvalue = chl %>%
filter(time == "2021-12-31") %>%
pull(chlorophyll)
aa = matrix(nrow = lonLength, ncol = latLength) %>%
terra::rast()
new_ext = terra::ext(lonRange[1],lonRange[2],latRange[1], latRange[2])
terra::ext(aa) = new_ext
aa.values = terra::setValues(x = aa, values = zvalue)
ggplot()+
geom_spatraster(data = aa.values, maxcell = 500)+
geom_spatraster_contour(data = aa.values)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
require(magrittr)
require(terra)
require(tidyterra)
require(tidyverse)
chl = rerddap::griddap(
x = "erdMH1chla8day",
longitude = c(38, 39.5),
latitude = c(-6.5,-5.0),
time = c("2022-01-01", "2022-01-31"),
fmt = "csv") %>%
dplyr::as_tibble() %>%
dplyr::mutate(time = lubridate::as_date(time))
chl
chl
chl %>%
filter(time == "2021-12-31") %>%
select(-time) %>%
raster::rasterFromXYZ()
chl %>%
filter(time == "2021-12-31") %>%
select(-time) %>%
terra::rast()
chl_rast = matrix(nrow = lonLength, ncol = latLength) %>%
terra::rast()
chl_rast
new_ext = terra::ext(lonRange[1],lonRange[2],latRange[1], latRange[2])
terra::ext(chl_rast) = new_ext
chl_rast = terra::setValues(x = chl_rast, values = zvalue)
chl_rast
chl_rast = matrix(nrow = lonLength, ncol = latLength) %>%
terra::rast()
chl_rast
terra::ext(chl_rast) = new_ext
chl_rast
chl_rast
0.04054054*110
chl_rast = terra::setValues(x = chl_rast, values = zvalue)
chl_rast
chl %>%
filter(time == "2021-12-31") %>%
select(-time) %>%
terra::as.raster()
chl %>%
filter(time == "2021-12-31") %>%
select(-time)
chl %>%
filter(time == "2021-12-31") %>%
select(-time) %>%
as.data.frame()
chl %>%
filter(time == "2021-12-31") %>%
select(-time) %>%
as.data.frame() %>%
terra::as.raster()
chl %>%
filter(time == "2021-12-31") %>%
select(-time) %>%
# as.data.frame() %>%
terra::as.raster()
chl %>%
filter(time == "2021-12-31") %>%
select(-time) %>%
as_tibble() %>%
terra::as.raster()
chl %>%
filter(time == "2021-12-31") %>%
select(-time) %>%
terra::rast()
ggplot()+
geom_spatraster(data = chl_rast, maxcell = 2000)+
geom_spatraster_contour(data = chl_rast)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = chl_rast, maxcell = 2000)+
geom_spatraster_contour(data = chl_rast, breaks = 1)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
ggplot()+
geom_spatraster(data = chl_rast, maxcell = 2000)+
geom_spatraster_contour(data = chl_rast, breaks = .5)+
ggspatial::layer_spatial(tz, fill = "#84837a", color = "black", linewidth = .5)+
scale_fill_gradientn(colours = oce::oce.colors9A(120), trans = scales::log10_trans(),
name = expression(Chl-a~(mg^{-3})))+
metR::scale_x_longitude(ticks = .3)+
metR::scale_y_latitude(ticks = .3) +
coord_sf(xlim = c(38.7,39.4), ylim = c(-6.45,-5.5))+
theme_bw()+
theme(strip.background = element_rect(fill = "white"))
chl_rast %>%
autop
chl_rast %>%
autop
chl_rast %>%
autoplot()
chl_rast %>%
terra::autoplot()
chl_rast %>%
tidyterra::auto
chl_rast %>%
tidyterra::auto
chl_rast %>%
tidyterra::auto
chl_rast %>%
tidyterra::autoplot()
require(sf)
#| echo: false
tz = sf::st_read("tz.gpkg", quiet = TRUE)
#| echo: false
tz = sf::st_read("tz.gpkg", quiet = TRUE)
