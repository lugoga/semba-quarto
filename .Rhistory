width = unit(1, "cm"),
pad_x = unit(0.25, "cm"),
pad_y = unit(0.25, "cm"),
rotation = NULL)+
ggspatial::annotation_scale(location = "bl")+
scale_fill_hypso_tint_c(
palette = "gmt_globe",
labels = scales::label_number(big.mark = ","),
limits = c(-2000,2000),
breaks = seq(-3000,3000,500),
guide = guide_colorbar(
direction = "vertical",
title.position = "right",
title.theme = element_text(angle = 90),
barheight = 20,
barwidth = .40)
)
#| warning: false
#| message: false
#|
ggplot() +
geom_spatraster(data = gebco.pemba, show.legend = TRUE)+
geom_spatraster_contour(data = gebco.pemba, breaks = c(-200)) +
ggspatial::layer_spatial(data = africa, fill = NA, color = "black")+
geom_sf_text(data = africa, aes(label = str_to_upper(CNTRY_NAME)),
size = 2.3, check_overlap = TRUE)+
coord_sf(xlim = c(38.9,40), ylim = c(-5.6,-4.1))+
theme_bw() +
theme(legend.position = "right", axis.title = element_blank())+
ggspatial::annotation_north_arrow(location = "tr",
height = unit(1.5, "cm"),
width = unit(1, "cm"),
pad_x = unit(0.25, "cm"),
pad_y = unit(0.25, "cm"),
rotation = NULL)+
ggspatial::annotation_scale(location = "bl")+
scale_fill_hypso_tint_c(
palette = "gmt_globe",
labels = scales::label_number(big.mark = ","),
limits = c(-2000,2000),
breaks = seq(-3000,3000,500),
guide = guide_colorbar(
title = "Bathymetry and Elevation",
direction = "vertical",
title.position = "right",
title.theme = element_text(angle = 90),
barheight = 20,
barwidth = .40)
)
#| warning: false
#| message: false
#|
ggplot() +
geom_spatraster(data = gebco.pemba, show.legend = TRUE)+
geom_spatraster_contour(data = gebco.pemba, breaks = c(-200)) +
ggspatial::layer_spatial(data = africa, fill = NA, color = "black")+
geom_sf_text(data = africa, aes(label = str_to_upper(CNTRY_NAME)),
size = 2.3, check_overlap = TRUE)+
coord_sf(xlim = c(38.9,40), ylim = c(-5.6,-4.1))+
theme_bw() +
theme(legend.position = "right", axis.title = element_blank())+
ggspatial::annotation_north_arrow(location = "tr",
height = unit(1.5, "cm"),
width = unit(1, "cm"),
pad_x = unit(0.25, "cm"),
pad_y = unit(0.25, "cm"),
rotation = NULL)+
ggspatial::annotation_scale(location = "bl")+
scale_fill_hypso_tint_c(
palette = "gmt_globe",
labels = scales::label_number(big.mark = ","),
limits = c(-2000,2000),
breaks = seq(-3000,3000,500),
guide = guide_colorbar(
title = "Bathymetry and Elevation",
title.vjust = .5,
direction = "vertical",
title.position = "right",
title.theme = element_text(angle = 90),
barheight = 20,
barwidth = .40)
)
#| warning: false
#| message: false
#|
ggplot() +
geom_spatraster(data = gebco.pemba, show.legend = TRUE)+
geom_spatraster_contour(data = gebco.pemba, breaks = c(-200)) +
ggspatial::layer_spatial(data = africa, fill = NA, color = "black")+
geom_sf_text(data = africa, aes(label = str_to_upper(CNTRY_NAME)),
size = 2.3, check_overlap = TRUE)+
coord_sf(xlim = c(38.9,40), ylim = c(-5.6,-4.1))+
theme_bw() +
theme(legend.position = "right", axis.title = element_blank())+
ggspatial::annotation_north_arrow(location = "tr",
height = unit(1.5, "cm"),
width = unit(1, "cm"),
pad_x = unit(0.25, "cm"),
pad_y = unit(0.25, "cm"),
rotation = NULL)+
ggspatial::annotation_scale(location = "bl")+
scale_fill_hypso_tint_c(
palette = "gmt_globe",
labels = scales::label_number(big.mark = ","),
limits = c(-2000,2000),
breaks = seq(-3000,3000,500),
guide = guide_colorbar(
title = "Bathymetry and Elevation",
title.hjust = .5,
direction = "vertical",
title.position = "right",
title.theme = element_text(angle = 90),
barheight = 20,
barwidth = .40)
)
#| warning: false
#| message: false
#|
ggplot() +
geom_spatraster(data = gebco.pemba, show.legend = TRUE)+
geom_spatraster_contour(data = gebco.pemba, breaks = c(-200)) +
ggspatial::layer_spatial(data = africa, fill = NA, color = "black")+
geom_sf_text(data = africa, aes(label = str_to_upper(CNTRY_NAME)),
size = 2.3, check_overlap = TRUE)+
coord_sf(xlim = c(38.9,40), ylim = c(-5.6,-4.1))+
theme_bw() +
theme(legend.position = "right", axis.title = element_blank())+
ggspatial::annotation_north_arrow(location = "tr",
height = unit(1.5, "cm"),
width = unit(1, "cm"),
pad_x = unit(0.25, "cm"),
pad_y = unit(0.25, "cm"),
rotation = NULL)+
ggspatial::annotation_scale(location = "bl")+
scale_fill_hypso_tint_c(
palette = "gmt_globe",
labels = scales::label_number(big.mark = ","),
limits = c(-2000,2000),
breaks = seq(-3000,3000,500),
guide = guide_colorbar(
title = "Bathymetry and Elevation",
title.hjust = .5,
direction = "vertical",
title.position = "right",
title.theme = element_text(angle = 90),
barheight = 10,
barwidth = .40)
)
#| warning: false
#| message: false
#|
ggplot() +
geom_spatraster(data = gebco.pemba, show.legend = TRUE)+
geom_spatraster_contour(data = gebco.pemba, breaks = c(-200)) +
ggspatial::layer_spatial(data = africa, fill = NA, color = "black")+
geom_sf_text(data = africa, aes(label = str_to_upper(CNTRY_NAME)),
size = 2.3, check_overlap = TRUE)+
coord_sf(xlim = c(38.9,40), ylim = c(-5.6,-4.1))+
theme_bw() +
theme(legend.position = "right", axis.title = element_blank())+
ggspatial::annotation_north_arrow(location = "tr",
height = unit(1.5, "cm"),
width = unit(1, "cm"),
pad_x = unit(0.25, "cm"),
pad_y = unit(0.25, "cm"),
rotation = NULL)+
ggspatial::annotation_scale(location = "bl")+
scale_fill_hypso_tint_c(
palette = "gmt_globe",
labels = scales::label_number(big.mark = ","),
limits = c(-2000,2000),
breaks = seq(-3000,3000,500),
guide = guide_colorbar(
title = "Bathymetry and Elevation",
title.hjust = .5,
direction = "vertical",
title.position = "right",
title.theme = element_text(angle = 90),
barheight = 10,
barwidth = .60)
)
citation(terra)
citation("terra")
citation("tidyterra")
gebco
0.004166667*110*1000
gebco
gebco.pemba = gebco  %>%
terra::ext(38,41,-6.2,-3.8) %>%
terra::crop()
terra::ext(38,41,-6.2,-3.8)
gebco  %>%
terra::ext(38,41,-6.2,-3.8)
gebco.pemba = gebco  %>%
terra::crop(terra::ext(38,41,-6.2,-3.8))
gebco.pemba
#| warning: false
#| message: false
#| label: fig-fig4
#| fig-cap: Bathymetry and elevation of the Pemba Channel
#|
ggplot() +
geom_spatraster(data = gebco.pemba, show.legend = TRUE)+
geom_spatraster_contour(data = gebco.pemba, breaks = c(-200)) +
geom_spatvector(data = africa, fill = NA, color = "black")+
geom_sf_text(data = africa, aes(label = str_to_upper(CNTRY_NAME)),
size = 2.3, check_overlap = TRUE)+
coord_sf(xlim = c(38.9,40), ylim = c(-5.6,-4.1))+
theme_bw() +
theme(legend.position = "right", axis.title = element_blank())+
ggspatial::annotation_north_arrow(location = "tr",
height = unit(1.5, "cm"),
width = unit(1, "cm"),
pad_x = unit(0.25, "cm"),
pad_y = unit(0.25, "cm"),
rotation = NULL)+
ggspatial::annotation_scale(location = "bl")+
scale_fill_hypso_tint_c(
palette = "gmt_globe",
labels = scales::label_number(big.mark = ","),
limits = c(-2000,2000),
breaks = seq(-3000,3000,500),
guide = guide_colorbar(
title = "Bathymetry and Elevation",
title.hjust = .5,
direction = "vertical",
title.position = "right",
title.theme = element_text(angle = 90),
barheight = 10,
barwidth = .60)
)
pemba.ext = terra::ext(38,41,-6.2,-3.8)
gebco.pemba = gebco  %>%
terra::crop(pemba.ext)
gebco.pemba
pemba.ext = terra::ext(38,41,-6.2,-3.8)
gebco.pemba = terra::crop(x = gebco, y = pemba.ext)
gebco.pemba
#| warning: false
#| message: false
#| label: fig-fig4
#| fig-cap: Bathymetry and elevation of the Pemba Channel. Solid black line is an isobar contour of 200 meter
#|
ggplot() +
geom_spatraster(data = gebco.pemba, show.legend = TRUE)+
geom_spatraster_contour(data = gebco.pemba, breaks = c(-200), linewidth = 2) +
geom_spatvector(data = africa, fill = NA, color = "black")+
geom_sf_text(data = africa, aes(label = str_to_upper(CNTRY_NAME)),
size = 2.3, check_overlap = TRUE)+
coord_sf(xlim = c(38.9,40), ylim = c(-5.6,-4.1))+
theme_bw() +
theme(legend.position = "right", axis.title = element_blank())+
ggspatial::annotation_north_arrow(location = "tr",
height = unit(1.5, "cm"),
width = unit(1, "cm"),
pad_x = unit(0.25, "cm"),
pad_y = unit(0.25, "cm"),
rotation = NULL)+
ggspatial::annotation_scale(location = "bl")+
scale_fill_hypso_tint_c(
palette = "gmt_globe",
labels = scales::label_number(big.mark = ","),
limits = c(-2000,2000),
breaks = seq(-3000,3000,500),
guide = guide_colorbar(
title = "Bathymetry and Elevation",
title.hjust = .5,
direction = "vertical",
title.position = "right",
title.theme = element_text(angle = 90),
barheight = 10,
barwidth = .60)
)
require(tidyverse)
sst.lv = wior::get_sstMUR(lon.min = 29, lon.max = 36, lat.min = -6, lat.max = 2, t1 = "2022-01-01", t2 = "2022-12-31", level = 3)
sst.lv = wior::get_sstMUR(lon.min = 32, lon.max = 34, lat.min = -2.2, lat.max = 2, t1 = "2022-01-01", t2 = "2022-12-31", level = 3)
sst.lv = wior::get_sstMUR(lon.min = 32, lon.max = 34, lat.min = -2.2, lat.max = 2, t1 = "2022-01-01", t2 = "2022-12-31", level = 2)
sst.lv
mvua = wior::get_precip(lon.min = 32, lon.max = 34, lat.min = -2.2, lat.max = 2, t1 = "2022-01-01", t2 = "2022-12-31", level = 3)
sst.lv %>%
mutate(month = lubridate::month(label = T))
sst.lv %>%
mutate(month = lubridate::month(time, label = T))
sst.lv = sst.lv %>%
mutate(month = lubridate::month(time, label = T))
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst)
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
raster::rasterFromXYZ(res = 4326)
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
as.data.frame() %>%
raster::rasterFromXYZ(res = 4326)
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
as.data.frame() %>%
raster::rasterFromXYZ(res = 4326) %>%
terra::rast()
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
as.data.frame() %>%
raster::rasterFromXYZ(crs = 4326) %>%
terra::rast()
sst.lv %>%
distinct(month)
sst.lv %>%
select(x = longitude, y = latitude, z = sst) %>%
as.data.frame() %>%
raster::rasterFromXYZ(crs = 4326) %>%
terra::rast()
sst.lv %>%
select(x = longitude, y = latitude, z = sst) %>%
as.data.frame() %>%
raster::rasterFromXYZ(crs = 4326) %>%
terra::rast(nrow = 421, ncol = 201)
sst.lv %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast()
sst.lv %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast(nrow = 421, ncol = 201)
sst.lv %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast()
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast()
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast(nlyr = 12)
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast(nlyr = 1)
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast()
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast(nrows=180, ncols=360, nlyrs=1)
require(terra)
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast(nrows=180, ncols=360, nlyrs=1)
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast()
sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast() %>%
ggplot() +
tidyterra::geom_spatraster()
rast = sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast()
rast = sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast()
ggplot() +
tidyterra::geom_spatraster(data = rast)
ggplot() +
tidyterra::geom_spatraster(data = rast)+
coord_cartesian()
sst.lv = wior::get_sstMUR(
lon.min = 31, lon.max = 35,
lat.min = -3, lat.max = 1,
t1 = "2022-01-01", t2 = "2022-12-31",
level = 2
)
sst.lv = sst.lv %>%
mutate(month = lubridate::month(time, label = T))
rast = sst.lv %>%
filter(month == "Jan") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast()
ggplot() +
tidyterra::geom_spatraster(data = rast)+
coord_cartesian()
ggplot() +
tidyterra::geom_spatraster(data = rast)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120))
rast = sst.lv %>%
filter(month == "Jun") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast()
ggplot() +
tidyterra::geom_spatraster(data = rast)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120))
ggplot(data = rast) +
tidyterra::geom_spatraster()+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120))
ggplot() +
tidyterra::geom_spatraster(t)+
tidyterra::geom_spatraster(t)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120))
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster(data = rast, breaks = 25.5)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120))
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast, breaks = 25.5)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120))
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast, breaks = 26)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120))
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120))
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120))+
theme_bw()
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120), na.value = "white")+
theme_bw()
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast, bins = 4)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120), na.value = "white")+
theme_bw()
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast, bins = 2)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120), na.value = "white")+
theme_bw()
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast, bins = 8)+
coord_cartesian()+
scale_fill_gradientn(colours = oce::oce.colors9A(120), na.value = "white")+
theme_bw()
require(sf)
lv = st_read("d:/semba/2023/lv_cage/spatial/lake_victoria.shp", quiet = TRUE)
lv
lv = st_read("d:/semba/2023/lv_cage/spatial/lake_victoria.shp", quiet = TRUE) %>%
st_transform(crs = 4326)
lv
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast, bins = 8)+
tidyterra::geom_spatvector(data = lv) +
scale_fill_gradientn(colours = oce::oce.colors9A(120), na.value = "white")+
theme_bw()
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast, bins = 8)+
tidyterra::geom_spatvector(data = lv, fill = NA) +
scale_fill_gradientn(colours = oce::oce.colors9A(120), na.value = "white")+
theme_bw()
ls()
save.image("d:/semba/2023/zoning/sst.RData")
load("d:/semba/2023/zoning/sst.RData")
load("d:/semba/2023/zoning/sst.RData")
# sst.lv %>%
#   select(x = longitude, y = latitude, z = sst) %>%
#   raster::rasterFromXYZ(crs = 4326) %>%
#   terra::rast()
rast = sst.lv %>%
filter(month == "Jul") %>%
select(x = longitude, y = latitude, z = sst) %>%
terra::rast()
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast, bins = 8)+
tidyterra::geom_spatvector(data = lv, fill = NA) +
scale_fill_gradientn(colours = oce::oce.colors9A(120), na.value = "white")+
theme_bw()
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast, bins = 8)+
tidyterra::geom_spatvector(data = lv, fill = NA) +
scale_fill_gradientn(colours = oce::oce.colors9A(120), na.value = "white", trans = scales::log10_trans())+
theme_bw()
ggplot() +
tidyterra::geom_spatraster(data = rast)+
tidyterra::geom_spatraster_contour(data = rast, bins = 8)+
tidyterra::geom_spatvector(data = lv, fill = NA) +
scale_fill_gradientn(colours = oce::oce.colors9A(120), na.value = "white", trans = scales::sqrt_trans())+
theme_bw()
