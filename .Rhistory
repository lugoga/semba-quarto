group_by(Date)%>%
slice(5)
#| label: fig-trajectory
#| fig-cap: Trajectory of Argo float ID 1901124
#|
require(tmap)
tmap_mode(mode = "view")
argo.surface.tb %>%
st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326) %>%
tm_shape() +
tm_dots(col = "Temperature", id = "Date", palette = oce.colorsJet(120), n = 4, title = "Temperature <br> (Degree C)")
argo.surface.tb %>%
st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326) %>%
tm_shape(name = "Argo Profiles") +
tm_dots(col = "Temperature", id = "Date",
palette = oce.colorsJet(120), n = 4,
title = "Temperature <br> (Degree C)")
argo.surface.sf %>%
tm_shape() +
tm_bubbles(size = "Temperature", col = "Salinity")
argo.surface.sf
#| label: fig-trajectory
#| fig-cap: Trajectory of Argo float ID 1901124
#|
require(tmap)
tmap_mode(mode = "view")
argo.surface.sf = argo.surface.tb %>%
st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326)
argo.surface.sf %>%
tm_shape(name = "Argo Profiles") +
tm_dots(col = "Temperature", id = "Date",
palette = oce.colorsJet(120), n = 4,
title = "Temperature <br> (Degree C)")
argo.surface.sf %>%
tm_shape() +
tm_bubbles(size = "Temperature", col = "Salinity")
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(20, 30, by=2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Metro population",
title.col="Growth rate (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(28, 30, by=..2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Metro population",
title.col="Growth rate (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(28, 30, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Metro population",
title.col="Growth rate (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(28, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Metro population",
title.col="Growth rate (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(28, 36, by=2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Metro population",
title.col="Growth rate (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(24, 36, by=.4), Inf),
palette="-RdYlBu", contrast=1,
title.size="Metro population",
title.col="Growth rate (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34, 36, by=.4), Inf),
palette="-RdYlBu", contrast=1,
title.size="Metro population",
title.col="Growth rate (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34, 35, by=.4), Inf),
palette="-RdYlBu", contrast=1,
title.size="Metro population",
title.col="Growth rate (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.4), Inf),
palette="-RdYlBu", contrast=1,
title.size="Metro population",
title.col="Growth rate (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Metro population",
title.col="Growth rate (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity", digits = 2,
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Metro population",
title.col="Growth rate (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date"
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature <br> (degree)"="Temperature", "Salinity <br> surface"="Salinity", "Growth (%)"="growth"),
popup.format=list(growth=list(digits=4))
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature <br> (degree)"="Temperature", "Salinity <br> surface"="Salinity"),
popup.format=list(growth=list(digits=4))
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature <br> (degree)"="Temperature", "Salinity <br> surface"="Salinity"),
popup.format=list(Temperature=list(digits=4))
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature <br> (degree)"="Temperature", "Salinity <br> surface"="Salinity"),
popup.format=list(Temperature=list(digits=2))
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature: "="Temperature", "Salinity: "="Salinity"),
popup.format=list(Temperature=list(digits=2))
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature: "="Temperature", "Salinity: "="Salinity"),
popup.format=list(c(Temperature, Salinity)=list(digits=2))
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature: "="Temperature", "Salinity: "="Salinity"),
popup.format=list(c(Temperature)=list(digits=2)),
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature: "="Temperature", "Salinity: "="Salinity"),
popup.format=list(c(Temperature)=list(digits=2))
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature: "="Temperature", "Salinity: "="Salinity"),
popup.format=list(Temperature=list(digits=2)),
popup.format=list(Salinity=list(digits=2))
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature: "="Temperature", "Salinity: "="Salinity"),
popup.format=list(Salinity=list(digits=2))
)
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature: "="Temperature", "Salinity: "="Salinity"),
popup.format=list(Temperature=list(digits=2))
)
argo.surface.tb
argo.surface.tb %>%
select(-Time,-Scan)
aa =  argo.tb %>%
group_by(Date)%>%
slice(1)
aa
aa %>% write_csv("../data/argo_profile_cast_location.csv")
argo.surface.tb = read_csv("../data/argo_profile_cast_location.csv")
argo.surface.tb
argo.surface.tb = read_csv("../data/argo_profile_cast_location.csv") %>%
select(-Scan, -Time)
argo.surface.tb
argo.surface.tb
modis.sst = xtracto(dtype = "mhsstd8day",
xpos = argo.surface.tb$Longitude,
ypos = argo.surface.tb$Latitude,
tpos = argo.surface.tb$Date, ,#note a space here.A bug!!!!
xlen = 0.2,
ylen = 0.2)
## make character date in argo.surface.tab as date format
argo.surface.tb$Date = as.Date(argo.surface.tb$Date)
argo.surface.tb
modis.sst = xtracto(dtype = "mhsstd8day",
xpos = argo.surface.tb$Longitude,
ypos = argo.surface.tb$Latitude,
tpos = argo.surface.tb$Date, ,#note a space here.A bug!!!!
xlen = 0.2,
ylen = 0.2)
## load the package needed for the routine
# require(DT)
require(tidyverse)
require(lubridate)
require(spData)
require(sf)
require(oce)
require(xtractomatic)
# require(pals)
modis.sst = xtracto(dtype = "mhsstd8day",
xpos = argo.surface.tb$Longitude,
ypos = argo.surface.tb$Latitude,
tpos = argo.surface.tb$Date, ,#note a space here.A bug!!!!
xlen = 0.2,
ylen = 0.2)
## load the package needed for the routine
# require(DT)
require(tidyverse)
require(lubridate)
require(spData)
require(sf)
require(oce)
require(rerddapXtracto)
require(rerddap)
modis.sst = xtracto(dtype = "mhsstd8day",
xpos = argo.surface.tb$Longitude,
ypos = argo.surface.tb$Latitude,
tpos = argo.surface.tb$Date, ,#note a space here.A bug!!!!
xlen = 0.2,
ylen = 0.2)
require(tidyverse)
require(lubridate)
require(spData)
require(sf)
require(oce)
require(xtractomatic)
africa = sf::st_read("../data/africa.shp", quiet = TRUE) %>%
janitor::clean_names() %>%
dplyr::select(country = cntry_name )
tz.ke = africa %>%
mutate(country = str_to_upper(country))%>%
st_crop(xmin = 38.4, xmax = 40, ymin = -6.2, ymax = -3.8)
#| label: fig-aoi
#| fig-cap: A map showing the location of the Pemba channel in the Indian Ocean Region (WIO)
ggplot(data = tz.ke)+
geom_sf(fill = "ivory", col = "black", linewidth = .2)+
coord_sf(xlim = c(38.5, 40), ylim = c(-6,-4))+
geom_sf_label(aes(label = country), fill = "cyan4", alpha = 1, color = "white")+
theme_bw()+
theme(panel.background = element_rect(colour = 1, fill = "lightblue"),
panel.grid = element_line(colour = NA),
axis.text = element_text(colour = 1, size = 10))+
scale_x_continuous(breaks = seq(38.5, 40, length.out = 4)%>%round(digits = 1))+
scale_y_continuous(breaks = seq(-5.8, -4.1,length.out = 5)%>%round(digits = 1))+
labs(x = NULL, y = NULL)+
geom_text(aes(x = 39.36, y = -5.2,
label = "Pemba\nChannel"), col = "black")
argo.1901124 = read.argo("../data/1901124_prof.nc") %>%
handleFlags()
argo.1901124 %>%
print()
argo.section = argo.1901124 %>%
as.section()
#| label: fig-temperatureTime
#| fig-cap: Hydrographic Section of Temperature obtained after combining float profiles of Argo float
argo.section %>%
plot(which = "temperature",
ztype = "image",
xtype = "time",
ylim = c(1000,0))
#| label: fig-temperatureLongitude
#| fig-cap: Hydrographic Section of Salinity obtained after combining float profiles of Argo float
#|
argo.section%>%plot(which = "temperature", ztype = "image", xtype = "longitude", ylim = c(1000,0))
par(mfrow = c(1,2))
pemba.argo.section = argo.section %>%
subset(latitude > -6.1 & latitude<=-3.5 & longitude < 41)
pemba.argo.section
#| label: fig-pemba
#| fig-cap: Argo profile section off the Pemba Island Pemba with corresponding latitudinal-depth section of temperature and salinity
#| fig-width: 8
#| fig-height: 3
par(mfrow = c(1,3))
pemba.argo.section %>%
plot(showStations = T, which = c("map"))
pemba.argo.section %>%
plot(ztype = "image", xtype = "latitude", ylim = c(300,0),
showStations = T, which = c("temperature"),
longitude = c(35, 41), zcol = oce.colors9A(120))
pemba.argo.section %>%
plot(ztype = "image", xtype = "latitude", ylim = c(300,0),
showStations = T, which = c("salinity"),
longitude = c(35, 41), zcol = oce.colors9A(120))
## convert argo section to list
argo.list = argo.section[["station"]]
## extract lon from the argo list
longitude = argo.section[["longitude", "byStation"]]
## extract lat from the argo list
latitude = argo.section[["latitude", "byStation"]]
## time can not be extracte the same way lon and lat can. This is because the time is stored in the
time = argo.section[["time", "byStation"]]
#| label: fig-prof
#| fig-cap: Temperature and salinity profiles measured with Argo float in the offshore waters of the Pemba Island
#|
par(mfrow = c(2,3))
argo.list[[206]]%>%plot(which = 1, type = "l")
argo.list[[207]]%>%plot(which = 1, type = "l")
argo.list[[208]]%>%plot(which = 1, type = "l")
argo.list[[209]]%>%plot(which = 1, type = "l")
argo.list[[210]]%>%plot(which = 1, type = "l")
argo.list[[211]]%>%plot(which = 1, type = "l")
profile.01 = argo.list[[206]]@data%>%
as.data.frame()%>%
as.tibble()%>%
mutate(Date = argo.list[[206]]@metadata$startTime%>%as_datetime(tz = ""),
Longitude = argo.list[[206]]@metadata$longitude,
Latitude = argo.list[[206]]@metadata$latitude)%>%
separate(Date, c("Date", "Time"),sep = " ", remove = TRUE)%>%
dplyr::select(Scan = scan, Date, Time, Longitude, Latitude,
Depth = pressure, Temperature = temperature,
Salinity = salinity)
#| label: tbl-tb1
#| tbl-cap: Overview of CTD measurement of first cast of Argo float number 1901124
profile.01 %>%
select(-Time) %>%
# head(n = 10) %>%
mutate(across(is.numeric, round, 1)) %>%
DT::datatable(rownames = FALSE)
argo.tb = NULL
for (i in 1:217){
profile = argo.list[[i]] %>%
ctdDecimate(p = 20)
argo.tb[[i]] = profile@data%>%
as.data.frame() %>%
as.tibble()%>%
mutate(Date = profile@metadata$startTime%>%as_datetime(tz = ""),
Longitude = profile@metadata$longitude,
Latitude = profile@metadata$latitude)%>%
separate(Date, c("Date", "Time"),sep = " ", remove = TRUE)%>%
dplyr::select(Scan = scan, Date, Time, Longitude, Latitude,
Depth = pressure, Temperature = temperature,
Salinity = salinity)
}
argo.tb = argo.tb %>%
bind_rows()
argo.surface.tb =  argo.tb %>%
group_by(Date)%>%
slice(5)
#| label: fig-trajectory
#| fig-cap: Trajectory of Argo float ID 1901124
#|
require(tmap)
tmap_mode(mode = "view")
argo.surface.sf = argo.surface.tb %>%
st_as_sf(coords = c("Longitude", "Latitude"), crs = 4326)
argo.surface.sf %>%
tm_shape(name = "Argo Profiles") +
tm_dots(col = "Temperature", id = "Date",
palette = oce.colorsJet(120), n = 4,
title = "Temperature <br> (Degree C)")
argo.surface.sf %>%
tm_shape() +
tm_bubbles(
size = "Temperature", col = "Salinity",
border.col = "black", border.alpha = .5,
style="fixed", breaks=c(-Inf, seq(34.8, 36, by=.2), Inf),
palette="-RdYlBu", contrast=1,
title.size="Temperature",
title.col="Salinity (%)",
id="Date",
popup.vars=c("Temperature: "="Temperature", "Salinity: "="Salinity"),
popup.format=list(Temperature=list(digits=2))
)
argo.surface.tb
